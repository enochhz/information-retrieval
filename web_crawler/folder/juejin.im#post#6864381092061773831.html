<!doctype html>
<html data-n-head-ssr>
  <head >
    <title> 微前端“容器”——microcosmos实现</title><meta data-n-head="ssr" charset="utf-8"><meta data-n-head="ssr" name="viewport" content="width=device-width, initial-scale=1, user-scalable=no, viewport-fit=cover"><meta data-n-head="ssr" name="google-site-verification" content="cCHsgG9ktuCTgWgYfqCJql8AeR4gAne4DTZqztPoirE"><meta data-n-head="ssr" name="google-site-verification" content="nPvn9R5NJLsZKTv5VKIbn0OmkRcJ4PC6KdDoTX3n5Mw"><meta data-n-head="ssr" name="apple-itunes-app" content="app-id=987739104"><meta data-n-head="ssr" name="baidu-site-verification" content="qiK2a1kcFc"><meta data-n-head="ssr" name="360-site-verification" content="4c3c7d57d59f0e1a308462fbc7fd7e51"><meta data-n-head="ssr" name="sogou_site_verification" content="c49WUDZczQ"><meta data-n-head="ssr" name="msapplication-config" content="https://b-gold-cdn.xitu.io/favicons/v2/browserconfig.xml"><meta data-n-head="ssr" name="theme-color" content="#ffffff"><meta data-n-head="ssr" vmid="keywords" name="keywords" content="掘金,稀土,Vue.js,微信小程序,Kotlin,RxJava,React Native,Wireshark,敏捷开发,Bootstrap,OKHttp,正则表达式,WebGL,Webpack,Docker,MVVM"><meta data-n-head="ssr" vmid="description" name="description" content="掘金是一个帮助开发者成长的社区，是给开发者用的 Hacker News，给设计师用的 Designer News，和给产品经理用的 Medium。掘金的技术文章由稀土上聚集的技术大牛和极客共同编辑为你筛选出最优质的干货，其中包括：Android、iOS、前端、后端等方面的内容。用户每天都可以在这里找到技术世界的头条内容。与此同时，掘金内还有沸点、掘金翻译计划、线下活动、专栏文章等内容。即使你是 GitHub、StackOverflow、开源中国的用户，我们相信你也可以在这里有所收获。"><meta data-n-head="ssr" vmid="keywords" name="keywords" content="前端框架"><meta data-n-head="ssr" vmid="description" name="description" content=""><link data-n-head="ssr" rel="apple-touch-icon" sizes="180x180" href="https://b-gold-cdn.xitu.io/favicons/v2/apple-touch-icon.png"><link data-n-head="ssr" rel="icon" type="image/png" sizes="32x32" href="https://b-gold-cdn.xitu.io/favicons/v2/favicon-32x32.png"><link data-n-head="ssr" rel="icon" type="image/png" sizes="16x16" href="https://b-gold-cdn.xitu.io/favicons/v2/favicon-16x16.png"><link data-n-head="ssr" rel="manifest" href="https://b-gold-cdn.xitu.io/favicons/v2/manifest.json"><link data-n-head="ssr" rel="mask-icon" color="#5bbad5" href="https://b-gold-cdn.xitu.io/favicons/v2/safari-pinned-tab.svg"><link data-n-head="ssr" rel="shortcut icon" href="https://b-gold-cdn.xitu.io/favicons/v2/favicon.ico"><link data-n-head="ssr" rel="search" title="掘金" href="https://b-gold-cdn.xitu.io/conf/search.xml" type="application/opensearchdescription+xml"><link data-n-head="ssr" rel="stylesheet" href="https://b-gold-cdn.xitu.io/ionicons/2.0.1/css/ionicons.min.css"><link data-n-head="ssr" rel="stylesheet" href="https://b-gold-cdn.xitu.io/asset/fw-icon/1.0.9/iconfont.css"><link rel="preload" href="//s3.pstatp.com/toutiao/xitu_juejin_web/runtime.114be94.js" as="script"><link rel="preload" href="//s3.pstatp.com/toutiao/xitu_juejin_web/commons/app.f6a55cd.js" as="script"><link rel="preload" href="//s3.pstatp.com/toutiao/xitu_juejin_web/vendors~app.75ea36e.js" as="script"><link rel="preload" href="//s3.pstatp.com/toutiao/xitu_juejin_web/app.6946cbd.js" as="script"><link rel="preload" href="//s3.pstatp.com/toutiao/xitu_juejin_web/layouts/default.30f8654.js" as="script"><link rel="preload" href="//s3.pstatp.com/toutiao/xitu_juejin_web/commons/layouts.default.e3ae69c.js" as="script"><link rel="preload" href="//s3.pstatp.com/toutiao/xitu_juejin_web/16.042eec3.js" as="script"><link rel="preload" href="//s3.pstatp.com/toutiao/xitu_juejin_web/commons/.c96a556.js" as="script"><style data-vue-ssr-id="6d4e8b07:0 580fe052:0 19f03031:0 50f339e4:0 bc0d363a:0 336652cb:0 0094bb9d:0 190e79e4:0 10d680ba:0 291dc925:0 0df5c402:0 6d1bad94:0 0fd89be5:0 451eb286:0 c277c556:0 7192d33a:0">html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}body{margin:0}article,aside,details,figcaption,figure,footer,header,main,menu,nav,section,summary{display:block}audio,canvas,progress,video{display:inline-block}audio:not([controls]){display:none;height:0}progress{vertical-align:baseline}[hidden],template{display:none}a{background-color:transparent;-webkit-text-decoration-skip:objects}a:active,a:hover{outline-width:0}abbr[title]{border-bottom:none;text-decoration:underline;-webkit-text-decoration:underline dotted;text-decoration:underline dotted}b,strong{font-weight:inherit;font-weight:bolder}dfn{font-style:italic}h1{font-size:2em;margin:.67em 0}mark{background-color:#ff0;color:#000}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}img{border-style:none}svg:not(:root){overflow:hidden}code,kbd,pre,samp{font-family:monospace,monospace;font-size:1em}figure{margin:1em 40px}hr{box-sizing:content-box;height:0;overflow:visible}button,input,select,textarea{font:inherit;margin:0}optgroup{font-weight:700}button,input{overflow:visible}button,select{text-transform:none}[type=reset],[type=submit],button,html [type=button]{-webkit-appearance:button}[type=button]::-moz-focus-inner,[type=reset]::-moz-focus-inner,[type=submit]::-moz-focus-inner,button::-moz-focus-inner{border-style:none;padding:0}[type=button]:-moz-focusring,[type=reset]:-moz-focusring,[type=submit]:-moz-focusring,button:-moz-focusring{outline:1px dotted ButtonText}fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}legend{box-sizing:border-box;color:inherit;display:table;max-width:100%;padding:0;white-space:normal}textarea{overflow:auto}[type=checkbox],[type=radio]{box-sizing:border-box;padding:0}[type=number]::-webkit-inner-spin-button,[type=number]::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}[type=search]::-webkit-search-cancel-button,[type=search]::-webkit-search-decoration{-webkit-appearance:none}::-webkit-input-placeholder{color:inherit;opacity:.54}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}@font-face{font-family:iconfont;src:url(https://b-gold-cdn.xitu.io/fonts/iconfont.eot?t=1470110358);src:url(https://b-gold-cdn.xitu.io/fonts/iconfont.eot?t=1470110358#iefix) format("embedded-opentype"),url(https://b-gold-cdn.xitu.io/fonts/iconfont.woff?t=1470110358) format("woff"),url(https://b-gold-cdn.xitu.io/fonts/iconfont.ttf?t=1470110358) format("truetype"),url(https://b-gold-cdn.xitu.io/fonts/iconfont.svg?t=1470110358#iconfont) format("svg")}.iconfont{font-family:iconfont!important;font-style:normal;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}.icon-xlcollection:before{content:"\e600"}.icon-xlchatbox:before{content:"\e601"}.article-content{word-break:break-word;line-height:1.75;font-weight:400;font-size:15px;overflow-x:hidden}.article-content h1{margin:1.3rem 0;line-height:1.2}.article-content p{line-height:2.27rem}.article-content hr{border:none;border-top:1px solid #ddd;margin-top:2.7rem;margin-bottom:2.7rem}.article-content embed,.article-content iframe,.article-content img:not(.equation),.article-content video{max-width:100%!important;margin:0}.article-content img.lazyload{visibility:hidden}.article-content img.inited{background-color:#f8f9fa;background-position:50%;background-repeat:no-repeat;visibility:visible}.article-content img.loaded{background-image:none;background-color:transparent}.article-content img.error{background-image:url(//s3.pstatp.com/toutiao/xitu_juejin_web/img/image-error.3338abe.png)}.article-content img.equation{margin:0 .1em;max-width:100%!important;vertical-align:middle}.article-content img:not(.equation){cursor:zoom-in}.article-content figure{margin:2.7rem auto;text-align:center}.article-content figure figcaption{text-align:center;font-size:1rem;line-height:2.7rem;color:#909090}.article-content pre{line-height:1.93rem;overflow:auto}.article-content code,.article-content pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.article-content code{font-size:1rem;padding:.26rem .53em;word-break:break-word;color:#4e5980;background-color:#f8f8f8;border-radius:2px;overflow-x:auto}.article-content pre>code{font-size:1rem;padding:.67rem 1.3rem;margin:0;word-break:normal;display:block}.article-content a{color:#259}.article-content a:active,.article-content a:hover{color:#275b8c}.article-content table{display:inline-block!important;font-size:1rem;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.article-content thead{background:#f6f6f6;color:#000;text-align:left}.article-content tr:nth-child(2n){background-color:#fcfcfc}.article-content td,.article-content th{padding:1rem .6rem;line-height:2rem}.article-content td{min-width:10rem}.article-content blockquote{margin:1em 0;border-left:4px solid #ddd;padding:0 1.3rem}.article-content blockquote>p{margin:.6rem 0}.article-content ol,.article-content ul{padding-left:2.7rem}.article-content ol li,.article-content ul li{margin-bottom:.6rem}.article-content ol ol,.article-content ol ul,.article-content ul ol,.article-content ul ul{margin-top:.27rem}.article-content pre>code{overflow-x:auto;-webkit-overflow-scrolling:touch;color:#333;background:#f8f8f8}.article-content .hljs-comment,.article-content .hljs-quote{color:#998}.article-content .hljs-keyword,.article-content .hljs-selector-tag,.article-content .hljs-subst{color:#333;font-weight:700}.article-content .hljs-literal,.article-content .hljs-number,.article-content .hljs-tag .hljs-attr,.article-content .hljs-template-variable,.article-content .hljs-variable{color:teal}.article-content .hljs-doctag,.article-content .hljs-string{color:#d14}.article-content .hljs-section,.article-content .hljs-selector-id,.article-content .hljs-title{color:#900;font-weight:700}.article-content .hljs-subst{font-weight:400}.article-content .hljs-class .hljs-title,.article-content .hljs-type{color:#458;font-weight:700}.article-content .hljs-attribute,.article-content .hljs-name,.article-content .hljs-tag{color:navy;font-weight:400}.article-content .hljs-link,.article-content .hljs-regexp{color:#009926}.article-content .hljs-bullet,.article-content .hljs-symbol{color:#990073}.article-content .hljs-built_in,.article-content .hljs-builtin-name{color:#0086b3}.article-content .hljs-meta{color:#999;font-weight:700}.article-content .hljs-deletion{background:#fdd}.article-content .hljs-addition{background:#dfd}.article-content .hljs-emphasis{font-style:italic}.article-content .hljs-strong{font-weight:700}.article-content p{line-height:inherit;margin-top:22px;margin-bottom:22px}.article-content img{max-height:none}.article-content a{color:#0269c8;border-bottom:1px solid #d1e9ff}.article-content code{background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.article-content figure{margin:22px auto}.article-content figure figcaption{margin-top:2px;line-height:1.6}.article-content blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.article-content blockquote:after{display:block;content:""}.article-content blockquote>p{margin:10px 0}.article-content blockquote.warning{position:relative;border-left-color:#f75151;margin-left:8px}.article-content blockquote.warning:before{position:absolute;top:14px;left:-12px;background:#f75151;border-radius:50%;content:"!";width:20px;height:20px;color:#fff;display:flex;align-items:center;justify-content:center}.article-content ol,.article-content ul{padding-left:28px}.article-content ol li,.article-content ul li{margin-bottom:0;list-style:inherit}.article-content ol li.task-list-item,.article-content ul li.task-list-item{list-style:none}.article-content ol li.task-list-item ol,.article-content ol li.task-list-item ul,.article-content ul li.task-list-item ol,.article-content ul li.task-list-item ul{margin-top:0}.article-content ol li{padding-left:6px}.article-content pre{position:relative;line-height:1.75}.article-content pre>code{padding:15px 12px}.article-content pre>code.hljs[lang]{padding:18px 15px 12px}.article-content pre>code.hljs[lang]:before{content:attr(lang);position:absolute;right:15px;top:2px;color:hsla(0,0%,54.9%,.8)}.article-content pre>code.hljs[lang][lang=bash]:before{content:""}.article-content pre>code.copyable .copy-code-btn{position:absolute;top:6px;right:15px;font-size:12px;line-height:1;cursor:pointer;color:hsla(0,0%,54.9%,.8);transition:color .1s}.article-content pre>code.copyable .copy-code-btn:hover{color:#8c8c8c}.article-content pre>code.copyable.hljs[lang]:before{right:70px}.article-content h1,.article-content h2,.article-content h3,.article-content h4,.article-content h5,.article-content h6{color:#333;line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.article-content h1{font-size:30px;margin-bottom:5px}.article-content h2{padding-bottom:12px;font-size:24px;border-bottom:1px solid #ececec}.article-content h3{font-size:18px;padding-bottom:0}.article-content h4{font-size:16px}.article-content h5{font-size:15px}.article-content h6{margin-top:5px}.article-content h1.heading+h2.heading{margin-top:20px}.article-content h1.heading+h3.heading{margin-top:15px}.article-content .heading+.heading{margin-top:0}.article-content h1+:not(.heading){margin-top:25px}@media (max-width:720px){.article-content h1{font-size:24px}.article-content h2{font-size:20px}.article-content h3{font-size:18px}.article-content pre>code .copy-code-btn{display:none}.article-content pre>code.hljs[lang]:before{top:2px;right:15px}}@media (max-width:720px){.article-content pre>code.copyable.hljs[lang]:before{right:1rem}}#nprogress{pointer-events:none}#nprogress .bar{background:#007fff;position:fixed;z-index:1031;top:0;left:0;width:100%;height:2px}#nprogress .peg{display:block;position:absolute;right:0;width:100px;height:100%;box-shadow:0 0 10px #007fff,0 0 5px #007fff;opacity:1;transform:rotate(3deg) translateY(-4px)}.nprogress-custom-parent{overflow:hidden;position:relative}.nprogress-custom-parent #nprogress .bar,.nprogress-custom-parent #nprogress .spinner{position:absolute}@-webkit-keyframes nprogress-spinner{0%{transform:rotate(0deg)}to{transform:rotate(1turn)}}@keyframes nprogress-spinner{0%{transform:rotate(0deg)}to{transform:rotate(1turn)}}body{font-size:12px;line-height:normal}a,button,input{margin:initial}img{width:auto;height:auto}#juejin{overflow-x:visible;overflow-x:initial}html{font-size:12px;font-family:-apple-system,system-ui,Segoe UI,Roboto,Ubuntu,Cantarell,Noto Sans,sans-serif,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Arial;word-break:break-word;text-rendering:optimizeLegibility;color:#333;background-color:#f4f5f5}html.white{background-color:#fff}body{word-break:break-word;overflow-y:scroll}a{text-decoration:none;cursor:pointer;color:#909090}a:hover{color:#007fff}button{list-style:1}button:disabled{cursor:not-allowed}button.disabled,button.disabled:hover{background-color:#d2d2d2;cursor:not-allowed}ul{padding:0;margin:0}li{list-style:none}#juejin-seo-meta{display:none}.container{position:relative;margin:0 auto;width:100%;max-width:960px}.container:after{display:table;content:"";clear:both}.hidden{display:none}.root-view-bg{position:fixed;top:0;left:0;right:0;bottom:0;pointer-events:none;z-index:-1}.shadow{box-shadow:0 1px 2px 0 rgba(0,0,0,.05)}.align-center{text-align:center}.align-right{text-align:right}.align-middle{vertical-align:middle}.center{margin-left:auto;margin-right:auto}.text-normal{color:#333}.text-muted{color:#666}.text-muted1{color:#909090}.text-muted2{color:#838383}.text-gray{color:#909090}.text-light{color:#d2d2d2}.text-blue{color:#007fff}.text-blue-hover{color:#0371df}.text-green{color:#37c700}.text-green-hover{color:#3cb40e}.text-orange{color:#ff8900}.text-red{color:#e22323}.text-a,.text-link{cursor:pointer;color:#333}@include transition(color $speed-normal);.text-a:active,.text-a:hover,.text-link:active,.text-link:hover{color:#275b8c}.text-link{color:#259}.text-pointer{cursor:pointer}.line-wrap{white-space:pre-wrap;word-break:break-all}.ellipsis{white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.text-bold,b,strong{font-weight:700}.view-nav{position:fixed;top:5rem;width:100%;height:3.833rem;z-index:100;box-shadow:0 1px 2px 0 rgba(0,0,0,.05);transition:all .2s;transform:translateZ(0)}.view-nav,.view-nav:before{left:0;background-color:#fff}.view-nav:before{content:"";position:absolute;right:0;bottom:0;height:200%;z-index:-1}.view-nav.top{transform:translate3d(0,-5rem,0)}.view-nav .nav-list{max-width:960px;height:100%;margin:auto;display:flex;align-items:center;line-height:1}.view-nav .nav-list .nav-item{height:100%;align-items:center;display:flex;flex-shrink:0;font-size:1.16rem;color:#71777c;padding:0 1rem}.view-nav .nav-list .nav-item:first-child{padding:0 1rem 0 0}.view-nav .nav-list .nav-item:last-child{padding:0 0 0 1rem}.view-nav .nav-list .nav-item.active,.view-nav .nav-list .nav-item:hover{color:#007fff}.view-nav .nav-list .nav-item a{color:inherit}.nav-item{position:relative;cursor:pointer}.nav-item>a:before{content:"";position:absolute;top:0;right:0;bottom:0;left:0}@media (max-width:980px){.view-nav .nav-list{width:auto;overflow-x:auto}.view-nav .nav-list .nav-item:first-child,.view-nav .nav-list .nav-item:last-child{padding:0 1.5rem}}.list-header{padding:1.3rem 1rem;border-bottom:1px solid hsla(0,0%,59.2%,.1)}.list-header .list-nav,.list-header .nav-list{display:flex;justify-content:space-between}.list-header .nav-list{align-items:center;line-height:1}.list-header .nav-list .nav-item.active a,.list-header .nav-list .nav-item a:hover{color:#007fff}.list-header .left .nav-item{padding:0 1.2rem;font-size:1.16rem;border-right:1px solid hsla(0,0%,59.2%,.2)}.list-header .left .nav-item:last-child{border:none}.list-header .right .nav-item{font-size:1.16rem;padding:0 .7rem;position:relative}.list-header .right .nav-item:not(:last-child):after{width:2px;height:2px;border-radius:50%;transform:translate(-50%,-50%);content:"";position:absolute;left:100%;top:50%;background-color:#2b445d;transform:translateY(-50%);opacity:.5}@media (max-width:600px){.list-header .right{display:none}}.button,button{-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:#007fff;color:#fff;border-radius:2px;border:none;padding:.5rem 1.3rem;outline:none;transition:background-color .3s,color .3s;cursor:pointer}.button:hover,button:hover{background-color:#0371df;color:#fff}i+span{margin-left:.6rem}button+button{margin-left:.8rem}.subscribe-btn{border:1px solid #37c700;background-color:#fff;color:#37c700;margin:1rem auto;font-size:1.1rem}.subscribe-btn:hover{background-color:#fff;color:#3cb40e;border-color:#3cb40e}.subscribe-btn.subscribed{background-color:#37c700;color:#fff}.subscribe-btn.subscribed:hover{background-color:#3cb40e}.radio-group{cursor:pointer;display:flex;align-items:center;font-size:14px}.radio-group .radio-label{margin-left:6px}input[type=radio]{width:16px;height:16px;border:1px solid #bfcbd9;border-radius:50%;background-color:#fff;cursor:pointer;box-sizing:border-box;position:relative;outline:none;-webkit-appearance:none;-moz-appearance:none;appearance:none}input[type=radio]:after{width:6px;height:6px;border-radius:50%;background-color:#fff;content:"";position:absolute;left:50%;top:50%;transform:translate(-50%,-50%) scale(0);transition:transform .15s cubic-bezier(.71,-.46,.88,.6)}input[type=radio]:checked{border-color:#20a0ff;background:#3a9afc}input[type=radio]:checked:after{transform:translate(-50%,-50%) scale(1)}input[type=radio]:disabled{background-color:#eef1f6;border-color:#d1dbe5;cursor:not-allowed}input[type=radio]:disabled:checked{border-color:#d1dbe5;background-color:#d1dbe5}input[name=registerSmsCode]::-webkit-contacts-auto-fill-button{display:none;visibility:hidden}.editable,input[type=password],input[type=text],input[type=url],textarea{resize:none;outline:none;width:100%;display:block;box-shadow:none;border:1px solid #ddd;border-radius:2px;transition:border .3s;background-color:#fff;box-sizing:border-box}.aside-top-section{background-color:#fff;box-shadow:0 1px 2px 0 rgba(0,0,0,.05);border-radius:2px;margin-bottom:1.3rem;font-size:1.16rem;line-height:1.29;color:#333}.aside-top-section .aside-header{padding:1rem 1.3rem;border-bottom:1px solid hsla(0,0%,59.2%,.1);color:#333;font-size:1.16rem}.aside-top-section .aside-list{padding:1rem 1.3rem}.aside-top-section .aside-list .item{margin-bottom:1.5rem}.busy-icon:before{-webkit-animation:busy-ani 1s linear infinite;animation:busy-ani 1s linear infinite}@-webkit-keyframes busy-ani{to{transform:rotate(1turn)}}@keyframes busy-ani{to{transform:rotate(1turn)}}
.request-health-alert[data-v-ded0787a]{position:fixed;left:2rem;bottom:2rem;padding:1rem;max-width:50%;color:#e33;background-color:#f6e3e3;border:1px solid #e99;z-index:10000}@media (max-width:600px){.request-health-alert[data-v-ded0787a]{display:none}}.title[data-v-ded0787a]{margin:0 0 .4em;font-size:1.5em}.content[data-v-ded0787a]{line-height:1.5}.btn[data-v-ded0787a]{color:inherit;text-decoration:underline;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.close[data-v-ded0787a]{position:absolute;top:0;right:0;padding:1rem;cursor:pointer;opacity:.5}.close[data-v-ded0787a]:hover{opacity:1}
.emoji-barrage .full-screen[data-v-68506677]{position:fixed;left:0;top:0;width:100%;height:100%;z-index:1001;overflow:hidden}.emoji-inner-screen[data-v-68506677]{position:absolute;left:0;width:100%;height:100%;transform:translate3d(-100%,-100%,0)}.emoji-inner-screen .template[data-v-68506677]{position:relative;width:100%;height:100%}.emojin-inner-screen__0.animate[data-v-68506677]{-webkit-animation:left-data-v-68506677 6s ease-in;animation:left-data-v-68506677 6s ease-in}.emojin-inner-screen__1.animate[data-v-68506677]{-webkit-animation:6s ease-in normal-data-v-68506677;animation:6s ease-in normal-data-v-68506677}.emojin-inner-screen__2.animate[data-v-68506677]{-webkit-animation:right-data-v-68506677 6s ease-in;animation:right-data-v-68506677 6s ease-in}@-webkit-keyframes left-data-v-68506677{0%{transform:translate3d(-50%,-100%,0)}to{transform:translate3d(0,100%,0)}}@keyframes left-data-v-68506677{0%{transform:translate3d(-50%,-100%,0)}to{transform:translate3d(0,100%,0)}}@-webkit-keyframes normal-data-v-68506677{0%{transform:translate3d(0,-100%,0)}to{transform:translate3d(0,100%,0)}}@keyframes normal-data-v-68506677{0%{transform:translate3d(0,-100%,0)}to{transform:translate3d(0,100%,0)}}@-webkit-keyframes right-data-v-68506677{0%{transform:translate3d(50%,-100%,0)}to{transform:translate3d(0,100%,0)}}@keyframes right-data-v-68506677{0%{transform:translate3d(50%,-100%,0)}to{transform:translate3d(0,100%,0)}}
.modal-mask[data-v-6217922a]{position:fixed;top:0;left:0;width:100%;height:100%;background-color:rgba(0,0,0,.3);z-index:501}.bind-phone-number-form[data-v-6217922a]{position:fixed;padding:1.83rem 2.08rem;width:26.5rem;max-width:100%;font-size:1.167rem;background-color:#fff;border-radius:3px;box-sizing:border-box;top:50%;left:50%;z-index:502;transform:translate(-50%,-60%);box-shadow:0 2px 3px 0 rgba(0,0,0,.2)}.close-btn[data-v-6217922a]{float:right;cursor:pointer;opacity:.4}.close-btn[data-v-6217922a]:hover{opacity:1}.title[data-v-6217922a]{font-size:1.42rem;color:#000;font-weight:600;margin:0 0 1rem}.hint[data-v-6217922a]{font-size:1.25rem;line-height:1.6;font-weight:400;color:#000;margin-bottom:2rem}.hint>a[data-v-6217922a]{color:#007fff}.input-group[data-v-6217922a]{margin-bottom:1.5rem}.input-box[data-v-6217922a]{position:relative;margin-bottom:.8rem}.dropdown-box[data-v-6217922a]{padding:0 10px;border:1px solid #d9d9d9;display:flex;border-radius:2px;justify-content:center;align-items:center}.dropdown-box .input[data-v-6217922a]{border:none}.dropdown-box.focus[data-v-6217922a]{border-color:#007fff}.input[data-v-6217922a]{width:100%;border:1px solid #e9e9e9;border-radius:2px;outline:none;box-sizing:border-box;padding:.67rem .67rem .67rem 4px}.input[data-v-6217922a]:focus{border-color:#007fff}.number-input[data-v-6217922a]{width:74%}.btn[data-v-6217922a]{width:100%;height:2.92rem;color:#fff;background-color:#007fff;border-radius:2px;outline:none;box-sizing:border-box;cursor:pointer}.btn[data-v-6217922a]:disabled{background-color:#909090;cursor:default}.vcode-box[data-v-6217922a]{display:flex;justify-content:center;align-items:center}.vcode-box .input[data-v-6217922a]{width:auto;flex-grow:1;overflow:hidden}.vcode-box .img-vcode[data-v-6217922a]{border:1px solid #ddd;position:relative;box-sizing:border-box;overflow:hidden;z-index:0;width:160px;color:#333;height:40px;margin-left:15px;flex-shrink:0}.vcode-box .img-vcode img[data-v-6217922a]{max-height:46px}.vcode-box .img-vcode .hint[data-v-6217922a]{position:absolute;z-index:-1;top:0;left:0;display:flex;height:100%;width:100%;justify-content:center;align-items:center}.send-vcode-btn[data-v-6217922a]{position:absolute;top:0;right:0;height:100%;color:#007fff;font-size:1.25rem;line-height:1;background-color:transparent}.send-vcode-btn[data-v-6217922a]:disabled{color:#909090;cursor:default}.send-vcode-btn[data-v-6217922a]:hover(:not(:disabled)){opacity:.8}.masker-fade-enter-active[data-v-6217922a],.masker-fade-leave-active[data-v-6217922a]{transition:opacity .3s}.masker-fade-enter[data-v-6217922a],.masker-fade-leave-to[data-v-6217922a]{opacity:0}.form-fade-enter-active[data-v-6217922a],.form-fade-leave-active[data-v-6217922a]{transition:.3s}.form-fade-enter[data-v-6217922a],.form-fade-leave-to[data-v-6217922a]{transform:translate(-50%,-52%);opacity:0}
.dropdown-input-container[data-v-4e5eda86]{height:100%;display:flex}.dropdown-input-container input[data-v-4e5eda86]{border:none;outline:none;width:32px;margin:0;padding:0}.dropdown-input-container .dropdown-input-box[data-v-4e5eda86]:before{content:"+"}.dropdown-input-container .arrow[data-v-4e5eda86]{cursor:pointer;transition:all .45s cubic-bezier(.8,.15,.15,.86)}.dropdown-input-container .dropdown-pannel[data-v-4e5eda86]{position:absolute;width:220px;max-height:188px;border-radius:4px;box-shadow:0 2px 5px 0 rgba(0,0,0,.08);border:1px solid #e8e8e8;background-color:#fff;overflow-y:auto;z-index:200;top:40px;left:-2px}.dropdown-input-container li.item[data-v-4e5eda86]{padding:8px 10px;font-size:14px;line-height:20px;justify-content:space-between;display:flex}.dropdown-input-container li.item[data-v-4e5eda86]:hover{cursor:pointer;background-color:#f5f5f5}.dropdown-input-container li.item.selected[data-v-4e5eda86]{color:#007fff}.dropdown-input-container li>span[data-v-4e5eda86]:last-child{color:#999}
@font-face{font-family:iconfont;src:url(https://b-gold-cdn.xitu.io/fonts/iconfont.eot?t=1470110358);src:url(https://b-gold-cdn.xitu.io/fonts/iconfont.eot?t=1470110358#iefix) format("embedded-opentype"),url(https://b-gold-cdn.xitu.io/fonts/iconfont.woff?t=1470110358) format("woff"),url(https://b-gold-cdn.xitu.io/fonts/iconfont.ttf?t=1470110358) format("truetype"),url(https://b-gold-cdn.xitu.io/fonts/iconfont.svg?t=1470110358#iconfont) format("svg")}.iconfont[data-v-d6ec2d02]{font-family:iconfont!important;font-style:normal;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}.icon-xlcollection[data-v-d6ec2d02]:before{content:"\e600"}.icon-xlchatbox[data-v-d6ec2d02]:before{content:"\e601"}.column-view[data-v-d6ec2d02]{padding:0 0 8rem}.main-area[data-v-d6ec2d02]{position:relative;width:700px;max-width:100%;background-color:#fff;border-radius:2px;box-sizing:border-box}.main-area[data-v-d6ec2d02]:after{display:table;content:"";clear:both}.article-area[data-v-d6ec2d02]{margin-bottom:1.5rem;padding:0 2rem}.article[data-v-d6ec2d02]{margin-bottom:3rem;padding:2rem 0 0}.article-placeholder[data-v-d6ec2d02]{width:100%}.author-info-block[data-v-d6ec2d02]{display:flex;align-items:center;margin-bottom:2rem}.author-info-block .avatar-link[data-v-d6ec2d02]{font-size:0}.author-info-block .avatar[data-v-d6ec2d02]{flex:0 0 auto;margin-right:1rem;width:3.333rem;height:3.333rem;border-radius:50%}.author-info-block .author-info-box[data-v-d6ec2d02]{min-width:0;flex-grow:1;flex:1}.author-info-block .username[data-v-d6ec2d02]{display:inline-block;width:100%;font-size:1.3rem;font-weight:700;color:#333}.author-info-block .meta-box[data-v-d6ec2d02]{font-size:1.1rem;color:#909090}.author-info-block .time[data-v-d6ec2d02]{letter-spacing:1px}.author-info-block .views-count[data-v-d6ec2d02]{margin-left:.5em}.author-info-block .dot[data-v-d6ec2d02]{margin:0 .5em}@media (max-width:600px){.author-info-block .dot[data-v-d6ec2d02]{margin:0 .2em}}@media (max-width:600px){.author-info-block .follow[data-v-d6ec2d02]{margin-top:12px}}.author-info-block .edit-btn[data-v-d6ec2d02]{color:#1264b6;cursor:pointer}.author-info-block .edit-btn[data-v-d6ec2d02]:hover{text-decoration:underline}.article-hero[data-v-d6ec2d02]{margin-bottom:2rem;width:100%}.article-hero[data-v-d6ec2d02]:after{content:"";display:block;padding-top:56.29%;width:100%;pointer-events:none}.audit-show[data-v-d6ec2d02]{width:100%;height:70px;line-height:70px;background:#f4f5f5;border-radius:2px;font-size:16px;font-weight:400;color:#2e3135;text-align:center}.article-title[data-v-d6ec2d02]{margin:.67em 0;font-size:2.5rem;font-weight:700;line-height:1.5}@media (max-width:600px){.article-title[data-v-d6ec2d02]{font-size:2rem}}.tag-list-box[data-v-d6ec2d02]{margin-bottom:2rem}.tag-list-box .tag-list-title[data-v-d6ec2d02]{margin-bottom:2rem;padding:0 0 0 2rem;font-size:1.25rem;font-weight:600;color:#000;border-left:6px solid #ddd}.tag-list-box .tag-list[data-v-d6ec2d02]{display:flex;flex-wrap:wrap}.tag-list-box .tag-list .item[data-v-d6ec2d02]{display:flex;align-items:center;margin:0 1.25rem 1rem 0;padding:.167rem;background-color:#fff;border:1px solid #e3e3e3;border-radius:2px}.tag-list-box .tag-list .tag-icon[data-v-d6ec2d02]{width:1.75rem;height:1.75rem;border-radius:2px}@media (max-width:600px){.tag-list-box .tag-list .tag-icon[data-v-d6ec2d02]{display:none}}.tag-list-box .tag-list .tag-title[data-v-d6ec2d02]{padding:0 .75rem;font-size:1rem;line-height:1.75rem;color:#919191}.wechat-banner[data-v-d6ec2d02]{margin-bottom:2rem}@media (min-width:960px){.wechat-banner[data-v-d6ec2d02]{display:none}}.book-box[data-v-d6ec2d02]{margin-bottom:2rem}@media (min-width:960px){.book-box[data-v-d6ec2d02]{display:none}}.footer-author-block[data-v-d6ec2d02]{padding:15px 17px;border-radius:2px;background-color:#f4f5f5;margin-bottom:2rem}@media (max-width:600px){.footer-author-block[data-v-d6ec2d02]{padding:15px 1rem}}.article-banner[data-v-d6ec2d02]{margin-bottom:2.5rem;padding:0 0 0 2rem;border-left:6px solid #ddd}.article-banner .banner-title[data-v-d6ec2d02]{font-size:1.3rem;line-height:1.6;color:#007fff}.article-banner .banner-content[data-v-d6ec2d02]{margin-top:.2rem;font-size:1.1rem;line-height:1.4;color:#909090}.comment-box[data-v-d6ec2d02]{padding:0 2rem}.comment-box.extended[data-v-d6ec2d02]{padding-bottom:2rem}@media (max-width:600px){.comment-box[data-v-d6ec2d02]{padding:0}}.comment-box .comment-title[data-v-d6ec2d02]{margin-bottom:1.3rem;font-size:1.3rem;font-weight:500;text-align:center;color:#909090}.comment-box .comment-form[data-v-d6ec2d02]{margin-bottom:1rem}.recommended-entry-list-title[data-v-d6ec2d02]{padding:1.3rem 2rem;font-size:1.25rem;font-weight:600;color:#909090;border-bottom:1px solid rgba(178,186,194,.15)}.sidebar[data-v-d6ec2d02]{position:absolute;top:0;right:0;width:20rem}.article-suspended-panel[data-v-d6ec2d02]{position:fixed;margin-left:-7rem;top:16rem}.action-bar[data-v-d6ec2d02]{position:fixed;z-index:1;bottom:0;width:100%;left:0}@media (max-width:960px){.sidebar[data-v-d6ec2d02]{display:none}.main-area[data-v-d6ec2d02]{width:100%}.article-area[data-v-d6ec2d02]{margin-bottom:0}.open-in-app[data-v-d6ec2d02]{bottom:6rem}}.border[data-v-d6ec2d02]{border-bottom:1px solid rgba(178,186,194,.15)}
.main-header-box[data-v-6a3e47cf]{position:relative;height:5rem}.main-header[data-v-6a3e47cf]{position:fixed;top:0;left:0;right:0;transition:all .2s;transform:translate3d(0,-100%,0)}.main-header.visible[data-v-6a3e47cf]{transform:translateZ(0)}.main-container>.view[data-v-6a3e47cf]{margin-top:1.767rem}.main-container.with-view-nav>.view[data-v-6a3e47cf]{margin-top:4.67rem}.main-container.tight>.view[data-v-6a3e47cf]{margin-top:0}.main-container.tight.with-view-nav>.view[data-v-6a3e47cf]{margin-top:3.833rem}
@font-face{font-family:iconfont;src:url(https://b-gold-cdn.xitu.io/fonts/iconfont.eot?t=1470110358);src:url(https://b-gold-cdn.xitu.io/fonts/iconfont.eot?t=1470110358#iefix) format("embedded-opentype"),url(https://b-gold-cdn.xitu.io/fonts/iconfont.woff?t=1470110358) format("woff"),url(https://b-gold-cdn.xitu.io/fonts/iconfont.ttf?t=1470110358) format("truetype"),url(https://b-gold-cdn.xitu.io/fonts/iconfont.svg?t=1470110358#iconfont) format("svg")}.iconfont[data-v-20709686]{font-family:iconfont!important;font-style:normal;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}.icon-xlcollection[data-v-20709686]:before{content:"\e600"}.icon-xlchatbox[data-v-20709686]:before{content:"\e601"}.logo[data-v-20709686]{min-width:98px;margin-right:2rem}.nav-item a[data-v-20709686]{color:#71777c}.nav-item.active>.icon[data-v-20709686],.nav-item.active>a[data-v-20709686]{color:#007fff}.nav-item.discount[data-v-20709686]:after{content:"";position:absolute;width:35px;height:28px;background:url(//s3.pstatp.com/toutiao/xitu_juejin_web/img/half_discount.3daad5d.gif);background-size:35px 28px;right:-14px;top:10px}.nav-menu-item>a[data-v-20709686]{display:block;color:#71777c}.avatar[data-v-20709686]{width:2.5rem;height:2.5rem;position:relative}.avatar[data-v-20709686],.badge[data-v-20709686]{border-radius:50%}.badge[data-v-20709686]{position:absolute;top:10px;right:-5px;width:11px;height:11px;background-color:#2f74e9}.main-header[data-v-20709686]{background:#fff;border-bottom:1px solid #f1f1f1;color:#909090;height:5rem;z-index:250}.main-header .container[data-v-20709686]{max-width:960px;margin:auto}.container[data-v-20709686]{display:flex;align-items:center;height:100%}.main-nav[data-v-20709686]{height:100%;flex:1 0 auto}.main-nav-list[data-v-20709686]{display:flex}.phone-show-menu[data-v-20709686]{cursor:pointer;display:none}.phone-hide[data-v-20709686]{display:flex}.nav-list[data-v-20709686]{justify-content:flex-end;position:relative}.nav-item[data-v-20709686],.nav-list[data-v-20709686]{display:flex;align-items:center;height:100%;margin:0}.nav-item[data-v-20709686]{color:#71777c;padding:0 1.2rem;font-size:1.33rem;justify-content:center;cursor:pointer}.nav-item.activities .tip[data-v-20709686]{z-index:2;cursor:auto;width:17rem;background:#fff;padding:1rem;display:flex;justify-content:flex-start;position:absolute;top:4.5rem;left:-50%;margin-left:-3.7rem;color:#17181a;font-size:15px;border-radius:2px;box-shadow:0 2px 20px 0 rgba(0,0,0,.12)}.nav-item.activities .tip .panfish[data-v-20709686]{height:63px;width:57px;flex:0 0 auto;background-repeat:no-repeat;background-size:contain}.nav-item.activities .tip .content[data-v-20709686]{display:flex;flex-direction:column;padding:.5rem 0 0 .5rem;color:#17181a}.nav-item.activities .tip .content button[data-v-20709686]{padding:0;width:6.41rem;height:2rem;color:#fff;font-size:13px;border-radius:12px;margin-top:.5rem}.nav-item.activities .tip .triangle[data-v-20709686]{display:block;position:absolute;top:0;left:50%;width:1rem;height:1rem;transform:translate(-50%,-50%) rotate(45deg);background:#fff;border-top:1px solid #f4f5f5;border-left:1px solid #f4f5f5}.nav-item.activities .tip .close[data-v-20709686]{cursor:pointer;width:1rem;height:1rem;position:absolute;top:.5rem;right:.5rem;border-radius:50%;background:#fff;transform:rotate(45deg)}.nav-item.activities .tip .close[data-v-20709686]:after,.nav-item.activities .tip .close[data-v-20709686]:before{content:"";width:.8rem;height:2px;display:block;position:absolute;background:#c5c5c5;left:50%;top:50%;transform:translate(-50%,-50%)}.nav-item.activities .tip .close[data-v-20709686]:after{transform:translate(-50%,-50%) rotate(90deg)}.nav-item.activities .tip .close[data-v-20709686]:hover{opacity:.8}.nav-item .login-button[data-v-20709686]{border:1px solid #007fff;background-color:#fff;padding:.3rem 1.6rem;color:#007fff;line-height:1.9rem}.nav-item:hover>a[data-v-20709686]{color:#007fff}.nav-item[data-v-20709686]:last-child{padding-right:0}.nav-item.link-item[data-v-20709686]{padding:0 1.5rem;height:5rem}.nav-item.book.new-year a[data-v-20709686]:after{left:0;top:0;position:absolute;content:"";background-position:50%;background-repeat:no-repeat;background-size:60px auto;width:100%;height:100%}.nav-item.search[data-v-20709686]{flex:1 1 auto;justify-content:flex-end;cursor:auto}.nav-item.add[data-v-20709686]{cursor:default}.nav-item.notification:hover .icon[data-v-20709686]{color:#007fff}.nav-item.menu[data-v-20709686],.nav-item.submit[data-v-20709686]{position:relative}.nav-item.submit[data-v-20709686]{color:#007fff}.nav-item.submit[data-v-20709686]:hover{color:#0371df}.nav-item.submit[data-v-20709686]:after{content:"|";position:absolute;top:20px;left:100%;color:hsla(0,0%,59.2%,.4)}.nav-item.submit .submit-panel[data-v-20709686]{position:absolute;top:101%;left:-123px;width:326px;box-sizing:border-box;padding:2.5rem 2rem;border-radius:2px;color:#909090;font-size:1.1rem;background-color:#fff;box-shadow:0 1px 2px 0 rgba(0,0,0,.1);border:1px solid rgba(178,181,187,.5);cursor:default;z-index:11}.nav-item.submit .submit-panel[data-v-20709686]:before{content:"";position:absolute;top:0;left:50%;width:1rem;height:1rem;border-top:1px solid rgba(178,181,187,.5);border-left:1px solid rgba(178,181,187,.5);background-color:#fff;transform:rotate(45deg) translate(-50%,-50%);transform-origin:0 0}.nav-item.submit .submit-panel .title[data-v-20709686]{font-size:1.4rem;line-height:1;font-weight:700;color:#000;text-align:center;margin-bottom:2rem}.nav-item.submit .submit-panel .benefit-list[data-v-20709686]{margin-left:2rem}.nav-item.submit .submit-panel .item[data-v-20709686]{list-style:disc outside none;list-style:initial;margin-bottom:1rem}.nav-item.submit .submit-panel .link[data-v-20709686]{color:#6cbd45;text-decoration:underline}.nav-item.submit .submit-panel button[data-v-20709686]{display:block;margin:2rem auto 0;background-color:#83c73a;font-size:1.2rem;padding:1rem 4rem}.nav-item.auth[data-v-20709686]{color:#007fff;padding:0}.nav-item.auth span[data-v-20709686]:hover{color:#0371df}.nav-item.auth .login[data-v-20709686]:after{content:"·";margin:0 .4rem}.nav-item .icon[data-v-20709686]{font-size:2rem;color:#71777c}.nav-item .icon[data-v-20709686]:hover{color:#007fff}.submit-fixed-bg[data-v-20709686]{position:fixed;top:0;left:0;right:0;bottom:0;opacity:0;z-index:10}.search-form[data-v-20709686]{border:1px solid hsla(0,0%,59.2%,.2);background-color:rgba(227,231,236,.2);display:flex;align-items:center;justify-content:space-between;border-radius:2px}.search-form.active[data-v-20709686]{background-color:#fff;border:1px solid #007fff}.search-form .search-icon[data-v-20709686]{padding:0 .5rem;cursor:pointer}.search-form .search-input[data-v-20709686]{border:none;width:11rem;padding:.6rem 0 .6rem 1rem;box-shadow:none;outline:none;font-size:1.1rem;color:#666;background-color:transparent}.nav-menu[data-v-20709686]{position:absolute;width:11rem;left:50%;top:100%;transform:translateX(-50%);margin:0;padding:0;list-style:none;background-color:#fff;box-shadow:0 1px 2px 0 rgba(0,0,0,.1);border:1px solid rgba(177,180,185,.45);border-radius:4px;font-size:1.2rem}.nav-menu .nav-menu-item-group[data-v-20709686]{padding:1rem 0}.nav-menu .nav-menu-item[data-v-20709686]{font-size:1.3rem;cursor:pointer}.nav-menu .nav-menu-item[data-v-20709686]:hover{background-color:hsla(0,0%,94.9%,.5)}.nav-menu .nav-menu-item>a[data-v-20709686]{display:flex;align-items:center;padding:.5rem 1rem}.nav-menu .nav-menu-item>a>span[data-v-20709686]{margin-left:0;flex-grow:1}.nav-menu .nav-menu-item>a.link-icon[data-v-20709686]{padding-right:.5rem}.nav-menu .nav-menu-item .collect[data-v-20709686],.nav-menu .nav-menu-item .zan[data-v-20709686]{margin-right:.8rem;width:18.72px;height:18px}.nav-menu .nav-menu-item .icon-2018[data-v-20709686]{width:38px;height:20px;border-radius:1rem;margin-left:2px;background-image:url(https://gold-cdn.xitu.io/asset/2018/2018-icon.png);background-size:102% 100%;background-repeat:no-repeat;box-shadow:3px 3px 6px -3px #999}.nav-menu .nav-menu-item .icon-2018[data-v-20709686]:hover{opacity:.9}.nav-menu .more[data-v-20709686]{position:relative}.nav-menu .more:hover .more-dropdown-list[data-v-20709686]{display:block}.nav-menu .more .more-icon[data-v-20709686]{float:right;color:#b2bac2;font-size:1.2rem;line-height:2rem}.nav-menu.user-dropdown-list[data-v-20709686]{width:13.1rem;right:0;left:auto;transform:translateX(0)}.nav-menu.user-dropdown-list .nav-menu-item-group[data-v-20709686]:not(:last-child){border-bottom:1px solid rgba(0,0,0,.04)}.add-group[data-v-20709686]{display:flex;align-items:center;position:relative;height:2.667rem;cursor:pointer}.add-group.active .more-list[data-v-20709686]{display:block}.add-group .add-btn[data-v-20709686],.add-group .more[data-v-20709686]{height:100%;color:#fff;background-color:#007fff;border-radius:3px}.add-group .add-btn.active[data-v-20709686],.add-group .add-btn[data-v-20709686]:hover,.add-group .more.active[data-v-20709686],.add-group .more[data-v-20709686]:hover{background-color:#0876e4}.add-group .add-btn[data-v-20709686]{padding:0 .9rem;font-size:1.167rem;border-top-right-radius:0;border-bottom-right-radius:0}.add-group .more[data-v-20709686]{flex:0 0 auto;display:flex;align-items:center;justify-content:center;width:1.25rem;border-left:1px solid hsla(0,0%,100%,.1);border-top-left-radius:0;border-bottom-left-radius:0}.add-group .more .more-icon[data-v-20709686]{margin-top:.2rem;font-size:1rem}.add-group .more-list[data-v-20709686]{position:absolute;top:100%;left:0;right:0;padding:.417rem 0;font-size:1.167rem;color:#3b76c5;background-color:#fff;border:1px solid #ebebeb;border-radius:2px;box-shadow:0 1px 2px 0 rgba(0,0,0,.05);display:none;z-index:1}.add-group .more-list .item[data-v-20709686]{padding:0 0 0 .8rem;line-height:1.9}.add-group .more-list .item[data-v-20709686]:hover{background-color:#f9f9f9}.more-dropdown-list[data-v-20709686]{position:absolute;left:auto;top:0;right:102%;transform:translateX(0);display:none}.more-dropdown-list[data-v-20709686]:after{content:"";position:absolute;top:0;left:100%;width:1.3rem;height:4rem}.notification[data-v-20709686]{position:relative}.notification.active .icon[data-v-20709686]{color:#007fff}.notification .count[data-v-20709686]{position:absolute;left:50%;bottom:43%;margin:0;font-size:1rem;line-height:1;text-align:center;background-color:#007fff;border-radius:3rem;word-break:normal;display:inline-block;color:#f1f1f1;transform:scale(.8);font-size:13px;font-weight:500;padding:3px 6px;background:#f03535;border-radius:100px;border:2px solid #fff}.fengwei[data-v-20709686]{display:inline-block;width:1em;height:1em;margin-right:.8rem;font-size:1.2em;vertical-align:middle;color:#b2bac2}.fix-bg[data-v-20709686]{position:fixed;top:0;left:0;bottom:0;right:0;opacity:0}.mobile[data-v-20709686]{display:none}@media (max-width:980px){.logo[data-v-20709686]{margin-right:0;margin-left:.67rem}.container[data-v-20709686]{width:96%}.main-nav-list[data-v-20709686]{display:block;position:absolute;left:0;top:0;background-color:#fff;z-index:1}.phone-show-menu[data-v-20709686]{height:5rem;display:flex;align-items:center;color:#007fff;font-size:1.33rem;justify-content:center;padding:0;width:5.66rem}.phone-show-menu span[data-v-20709686]{margin-right:.6rem}.phone-hide[data-v-20709686]{display:none;background-color:#fff;box-shadow:0 1px 2px 0 rgba(0,0,0,.1);border:1px solid rgba(177,180,185,.45);border-radius:4px;font-size:1.2rem}.phone-hide.show[data-v-20709686]{display:block}.nav-item.link-item[data-v-20709686]{height:4rem}.nav-item.add[data-v-20709686],.nav-item.submit[data-v-20709686],.pinTip[data-v-20709686]{display:none}.tip[data-v-20709686]{display:none!important}.nav-menu .nav-menu-item .icon-2018[data-v-20709686]{width:35px;margin-left:0}}@media (max-width:700px){.nav-item.search[data-v-20709686]{display:flex;padding-right:1.2rem}.nav-item .search-form .search-input[data-v-20709686]{width:11rem;padding:.6rem}.nav-item .search-form .search-icon[data-v-20709686]{display:none}.logo[data-v-20709686]{min-width:3.75rem}.logo-img[data-v-20709686]{display:none}.mobile[data-v-20709686]{display:block}.notification[data-v-20709686]{padding:0 .8rem}}@media (max-width:375px){.nav-item .search-form .search-input[data-v-20709686]{width:10rem}}@media (max-width:330px){.nav-item.search[data-v-20709686]{display:none}.nav-item.search .search-form .search-input[data-v-20709686]{width:5rem}}.tip-fade-enter-active[data-v-20709686],.tip-fade-leave-active[data-v-20709686]{transition:.3s}.tip-fade-enter[data-v-20709686],.tip-fade-leave-to[data-v-20709686]{transform:translateY(-10px);opacity:0}
.avatar[data-v-1c418ef0]{display:inline-block;position:relative;background-size:cover;background-color:#eee}.avatar[data-v-1c418ef0],.avatar.xmas[data-v-1c418ef0]:after{background-position:50%;background-repeat:no-repeat}.avatar.xmas[data-v-1c418ef0]:after{content:"";position:absolute;left:25%;bottom:30%;width:90%;height:90%;background-size:contain;background-image:url(//s3.pstatp.com/toutiao/xitu_juejin_web/img/hats.12a740a.svg);transform:rotate(15deg);transform-origin:bottom right;transition:all .2s}.avatar.xmas[data-v-1c418ef0]:hover:after{transform:rotate(20deg)}
.lazy[data-v-47cc2604]{position:relative}.lazy[data-v-47cc2604]:before{content:"";position:absolute;top:0;left:0;right:0;bottom:0;background-color:inherit;border-radius:inherit}.lazy[data-v-47cc2604]:not(.immediate):before{transition:opacity .2s}.lazy.loaded[data-v-47cc2604]:before{opacity:0;pointer-events:none}
.username[data-v-1b6b7cba]{font-size:1.25rem;font-weight:600;color:#2e3135}.username .name[data-v-1b6b7cba]{display:inline-block;vertical-align:top;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.recommend-author-block .username .name[data-v-1b6b7cba]{max-width:130px}.recommendation-index-view .username .name[data-v-1b6b7cba]{max-width:200px}
.follow-button[data-v-06c7d5b3]{margin:0 0 0 auto;padding:0;width:55px;height:26px;font-size:13px;border:1px solid #6cbd45;color:#6cbd45;background-color:#fff}.follow-button[data-v-06c7d5b3]:hover{opacity:.8}.follow-button.followed[data-v-06c7d5b3]{color:#fff;border-color:#6cbd45;background-color:#6cbd45}
.thumb[data-v-7b344634]{background-position:50%;background-size:cover;background-repeat:no-repeat}
[data-v-78c9b824] .image-viewer{position:fixed;top:0;left:0;right:0;bottom:0;z-index:10000}[data-v-78c9b824] .image-viewer.loading:after{content:"";position:absolute;top:0;right:100%;width:50%;height:.2rem;background-color:#007fff;z-index:1;-webkit-animation:pro-data-v-78c9b824 1s ease-in-out infinite;animation:pro-data-v-78c9b824 1s ease-in-out infinite;-webkit-animation-delay:1s;animation-delay:1s}@-webkit-keyframes pro-data-v-78c9b824{0%{transform:translateZ(0)}to{transform:translate3d(300%,0,0)}}@keyframes pro-data-v-78c9b824{0%{transform:translateZ(0)}to{transform:translate3d(300%,0,0)}}
.panel-btn[data-v-19356a56]{position:relative;margin-bottom:.75rem;width:3rem;height:3rem;background-color:#fff;background-position:50%;background-repeat:no-repeat;border-radius:50%;box-shadow:0 2px 4px 0 rgba(0,0,0,.04);cursor:pointer}.panel-btn:not(.share-btn).active.with-badge[data-v-19356a56]:after{background-color:#74ca46}.panel-btn.with-badge[data-v-19356a56]:after{content:attr(badge);position:absolute;top:0;left:75%;padding:.1rem .4rem;font-size:1rem;text-align:center;line-height:1;white-space:nowrap;color:#fff;background-color:#b2bac2;border-radius:.7rem;transform-origin:left top;transform:scale(.75)}.panel-btn.like-btn[data-v-19356a56]{background-image:url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNiIgaGVpZ2h0PSIxNSIgdmlld0JveD0iMCAwIDE2IDE1Ij4KICAgIDxwYXRoIGZpbGw9IiNCMkJBQzIiIGZpbGwtcnVsZT0iZXZlbm9kZCIgZD0iTTIuODc0IDYuMDQ0VjE1aC0xLjczQy41MTMgMTUgMCAxNC4zODIgMCAxMy42MjRWNy41MjljMC0uNzkuNTM1LTEuNDg1IDEuMTQzLTEuNDg1aDEuNzMxek03LjYwNyAxLjI1QzcuNzIuNTA3IDguMzQ0LS4wMTMgOS4wMyAwYy45OC4wMTkgMS41NjMuODMzIDEuNzY2IDEuMjM1LjM3LjczNS4zOCAxLjk0Ni4xMjYgMi43MjQtLjIzLjcwNC0uNzYxIDEuNjI5LS43NjEgMS42MjloMy45ODJjLjQyIDAgLjgxMS4yMDYgMS4wNzIuNTYzYTEuNSAxLjUgMCAwIDEgLjIzMiAxLjI3MmwtMS44MDEgNi41MTNjLS4xNjQuNjI3LS43MDcgMS4wNjQtMS4zMiAxLjA2NEg0LjVWNS44OThDNi4yOTkgNS41MSA3LjQwNCAyLjU5IDcuNjA3IDEuMjQ5eiIvPgo8L3N2Zz4K)}.panel-btn.like-btn[data-v-19356a56]:hover{background-image:url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNiIgaGVpZ2h0PSIxNSIgdmlld0JveD0iMCAwIDE2IDE1Ij4KICAgIDxwYXRoIGZpbGw9IiM4QTkzQTAiIGZpbGwtcnVsZT0iZXZlbm9kZCIgZD0iTTIuODc0IDYuMDQ0VjE1aC0xLjczQy41MTMgMTUgMCAxNC4zODIgMCAxMy42MjRWNy41MjljMC0uNzkuNTM1LTEuNDg1IDEuMTQzLTEuNDg1aDEuNzMxek03LjYwNyAxLjI1QzcuNzIuNTA3IDguMzQ0LS4wMTMgOS4wMyAwYy45OC4wMTkgMS41NjMuODMzIDEuNzY2IDEuMjM1LjM3LjczNS4zOCAxLjk0Ni4xMjYgMi43MjQtLjIzLjcwNC0uNzYxIDEuNjI5LS43NjEgMS42MjloMy45ODJjLjQyIDAgLjgxMS4yMDYgMS4wNzIuNTYzYTEuNSAxLjUgMCAwIDEgLjIzMiAxLjI3MmwtMS44MDEgNi41MTNjLS4xNjQuNjI3LS43MDcgMS4wNjQtMS4zMiAxLjA2NEg0LjVWNS44OThDNi4yOTkgNS41MSA3LjQwNCAyLjU5IDcuNjA3IDEuMjQ5eiIvPgo8L3N2Zz4K)}.panel-btn.like-btn.active[data-v-19356a56]{background-image:url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNiIgaGVpZ2h0PSIxNSIgdmlld0JveD0iMCAwIDE2IDE1Ij4KICAgIDxwYXRoIGZpbGw9IiM2Q0JENDUiIGZpbGwtcnVsZT0iZXZlbm9kZCIgZD0iTTIuODc0IDYuMDQ0VjE1aC0xLjczQy41MTMgMTUgMCAxNC4zODIgMCAxMy42MjRWNy41MjljMC0uNzkuNTM1LTEuNDg1IDEuMTQzLTEuNDg1aDEuNzMxek03LjYwNyAxLjI1QzcuNzIuNTA3IDguMzQ0LS4wMTMgOS4wMyAwYy45OC4wMTkgMS41NjMuODMzIDEuNzY2IDEuMjM1LjM3LjczNS4zOCAxLjk0Ni4xMjYgMi43MjQtLjIzLjcwNC0uNzYxIDEuNjI5LS43NjEgMS42MjloMy45ODJjLjQyIDAgLjgxMS4yMDYgMS4wNzIuNTYzYTEuNSAxLjUgMCAwIDEgLjIzMiAxLjI3MmwtMS44MDEgNi41MTNjLS4xNjQuNjI3LS43MDcgMS4wNjQtMS4zMiAxLjA2NEg0LjVWNS44OThDNi4yOTkgNS41MSA3LjQwNCAyLjU5IDcuNjA3IDEuMjQ5eiIvPgo8L3N2Zz4K)}.panel-btn.like-btn.like-adjust[data-v-19356a56]{background-position:53% 46%}.panel-btn.comment-btn[data-v-19356a56]{background-image:url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNCIgaGVpZ2h0PSIxMyIgdmlld0JveD0iMCAwIDE0IDEzIj4KICAgIDxwYXRoIGZpbGw9IiNCMkJBQzIiIGZpbGwtcnVsZT0iZXZlbm9kZCIgZD0iTTE0IDB2OS4yM0g4LjgxNUwzLjM3IDEzVjkuMjNIMFYweiIvPgo8L3N2Zz4K)}.panel-btn.comment-btn[data-v-19356a56]:hover{background-image:url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNCIgaGVpZ2h0PSIxMyIgdmlld0JveD0iMCAwIDE0IDEzIj4KICAgIDxwYXRoIGZpbGw9IiM4QTkzQTAiIGZpbGwtcnVsZT0iZXZlbm9kZCIgZD0iTTE0IDB2OS4yM0g4LjgxNUwzLjM3IDEzVjkuMjNIMFYweiIvPgo8L3N2Zz4K)}.panel-btn.comment-btn.comment-adjust[data-v-19356a56]{background-position:50% 55%}.panel-btn.collect-btn[data-v-19356a56]{background-image:url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNyIgaGVpZ2h0PSIxNyIgdmlld0JveD0iMCAwIDE3IDE3Ij4KICAgIDxwYXRoIGZpbGw9IiNCMkJBQzIiIGZpbGwtcnVsZT0iZXZlbm9kZCIgZD0iTTkuMzMyIDE0Ljk2OGMtLjQ2LS4yNTUtMS4yMDUtLjI1NS0xLjY2NiAwTDQuMzUgMTYuNzk0Yy0uOTIxLjUwNi0xLjUyMy4wNDQtMS4zNDktMS4wMjdsLjYzNS0zLjg2N2MuMDg4LS41MzctLjE0Mi0xLjI4LS41MTYtMS42NkwuNDM2IDcuNWMtLjc0NS0uNzYtLjUxMS0xLjUwNC41MTYtMS42NmwzLjcwNy0uNTY0Yy41MTQtLjA4IDEuMTE5LS41MzggMS4zNDgtMS4wMjdMNy42NjUuNzMxYy40NjItLjk3NiAxLjIwOC0uOTczIDEuNjY3IDBsMS42NiAzLjUxOWMuMjMuNDg5LjgzMy45NSAxLjM0OSAxLjAyN2wzLjcwOC41NjRjMS4wMjkuMTU2IDEuMjU4LjkwMi41MTUgMS42NmwtMi42ODUgMi43MzljLS4zNzIuMzgtLjYwMyAxLjEyMy0uNTE1IDEuNjZsLjYzNCAzLjg2N2MuMTc2IDEuMDc0LS40MyAxLjUzMy0xLjM0OCAxLjAyN2wtMy4zMTgtMS44MjZ6Ii8+Cjwvc3ZnPgo=)}.panel-btn.collect-btn[data-v-19356a56]:hover{background-image:url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNyIgaGVpZ2h0PSIxNyIgdmlld0JveD0iMCAwIDE3IDE3Ij4KICAgIDxwYXRoIGZpbGw9IiM4QTkzQTAiIGZpbGwtcnVsZT0iZXZlbm9kZCIgZD0iTTkuMzMyIDE0Ljk2OGMtLjQ2LS4yNTUtMS4yMDUtLjI1NS0xLjY2NiAwTDQuMzUgMTYuNzk0Yy0uOTIxLjUwNi0xLjUyMy4wNDQtMS4zNDktMS4wMjdsLjYzNS0zLjg2N2MuMDg4LS41MzctLjE0Mi0xLjI4LS41MTYtMS42NkwuNDM2IDcuNWMtLjc0NS0uNzYtLjUxMS0xLjUwNC41MTYtMS42NmwzLjcwNy0uNTY0Yy41MTQtLjA4IDEuMTE5LS41MzggMS4zNDgtMS4wMjdMNy42NjUuNzMxYy40NjItLjk3NiAxLjIwOC0uOTczIDEuNjY3IDBsMS42NiAzLjUxOWMuMjMuNDg5LjgzMy45NSAxLjM0OSAxLjAyN2wzLjcwOC41NjRjMS4wMjkuMTU2IDEuMjU4LjkwMi41MTUgMS42NmwtMi42ODUgMi43MzljLS4zNzIuMzgtLjYwMyAxLjEyMy0uNTE1IDEuNjZsLjYzNCAzLjg2N2MuMTc2IDEuMDc0LS40MyAxLjUzMy0xLjM0OCAxLjAyN2wtMy4zMTgtMS44MjZ6Ii8+Cjwvc3ZnPgo=)}.panel-btn.collect-btn.active[data-v-19356a56]{background-image:url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNyIgaGVpZ2h0PSIxNyIgdmlld0JveD0iMCAwIDE3IDE3Ij4KICAgIDxwYXRoIGZpbGw9IiNGRkMzNDciIGZpbGwtcnVsZT0iZXZlbm9kZCIgZD0iTTkuMzMyIDE0Ljk2OGMtLjQ2LS4yNTUtMS4yMDUtLjI1NS0xLjY2NiAwTDQuMzUgMTYuNzk0Yy0uOTIxLjUwNi0xLjUyMy4wNDQtMS4zNDktMS4wMjdsLjYzNS0zLjg2N2MuMDg4LS41MzctLjE0Mi0xLjI4LS41MTYtMS42NkwuNDM2IDcuNWMtLjc0NS0uNzYtLjUxMS0xLjUwNC41MTYtMS42NmwzLjcwNy0uNTY0Yy41MTQtLjA4IDEuMTE5LS41MzggMS4zNDgtMS4wMjdMNy42NjUuNzMxYy40NjItLjk3NiAxLjIwOC0uOTczIDEuNjY3IDBsMS42NiAzLjUxOWMuMjMuNDg5LjgzMy45NSAxLjM0OSAxLjAyN2wzLjcwOC41NjRjMS4wMjkuMTU2IDEuMjU4LjkwMi41MTUgMS42NmwtMi42ODUgMi43MzljLS4zNzIuMzgtLjYwMyAxLjEyMy0uNTE1IDEuNjZsLjYzNCAzLjg2N2MuMTc2IDEuMDc0LS40MyAxLjUzMy0xLjM0OCAxLjAyN2wtMy4zMTgtMS44MjZ6Ii8+Cjwvc3ZnPgo=)}.panel-btn.weibo-btn[data-v-19356a56]{background-image:url(//s3.pstatp.com/toutiao/xitu_juejin_web/img/weibo.2076a57.svg)}.panel-btn.weibo-btn[data-v-19356a56]:hover{background-image:url(//s3.pstatp.com/toutiao/xitu_juejin_web/img/weibo-hover.9abf502.svg)}.panel-btn.qq-btn[data-v-19356a56]{background-image:url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNSIgaGVpZ2h0PSIxNiIgdmlld0JveD0iMCAwIDE1IDE2Ij4KICAgIDxwYXRoIGZpbGw9IiNCMkJBQzIiIGZpbGwtcnVsZT0iZXZlbm9kZCIgZD0iTTE0LjQ2OCAxMC4zMTJjLS4wMS0uOTU3LS4zOC0xLjQ3Ni0uODA3LTIuMTUzLS4xOTEtLjI4My0uNDEzLS40NzMtLjYwNS0uNzU1LS4wMy0uMTU0LjAzMy0uMjY4LS4wMTItLjY3MS0uMDQyLS42MDQtLjI2My0uODM4LS4zMS0uOTEyLjAyLS4xNi0uMDQzLTEuNDg1LS41MjMtMi4yNjhDMTAuNzUxLjk0MSA3Ljk4Mi44NDYgNy42NDMuODQ0SDcuNjRjLS4zMzkuMDAyLTMuMTA3LjA5Ny00LjU2OCAyLjcxLS40NzkuNzgyLS41NDMgMi4xMDYtLjUyMyAyLjI2Ny0uMDQ2LjA3NC0uMjY3LjMwOC0uMzEuOTEyLS4wNDQuNDAzLjAxOC41MTctLjAxMi42Ny0uMTkyLjI4NC0uNDEzLjQ3My0uNjA1Ljc1Ni0uNDI2LjY3Ny0uNzk3IDEuMTk2LS44MDYgMi4xNTMtLjAwNy43MTQuMTYyIDEuNjg3LjY2MyAxLjcuMTU4LS4wMTIuMjkyLS4xMTcuNTY2LS40MjQuMDgyLS4wOTIuMzctLjQ4LjQyOS0uNTg3LjA1Ni4xNDguMTkgMS4xODMgMS4xMiAxLjcyMy0uOTU2LjQ1LTEuNDI0LjczNS0xLjQ0IDEuMzE5LjAyLjMzOC40MjMuNzg3IDEuMTY1Ljk5NmE2LjA1IDYuMDUgMCAwIDAgMi45MjcuMDVjLjUzNS0uMTMuNjk2LS4yNiAxLjM5Ni0uNjQ0LjcuMzg1Ljg2LjUxNCAxLjM5NS42NDNhNi4wNTIgNi4wNTIgMCAwIDAgMi45MjctLjA0OWMuNzQyLS4yMDkgMS4xNDYtLjY1OCAxLjE2Ni0uOTk2LS4wMTYtLjU4NC0uNDg0LS44Ny0xLjQ0LTEuMzIuOTMtLjUzOCAxLjA2My0xLjU3NCAxLjEyLTEuNzIyLjA1OC4xMDcuMzQ2LjQ5NS40MjguNTg3LjI3NC4zMDcuNDA5LjQxMi41NjcuNDI0LjUtLjAxMy42Ny0uOTg2LjY2My0xLjd6Ii8+Cjwvc3ZnPgo=)}.panel-btn.qq-btn[data-v-19356a56]:hover{background-image:url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNSIgaGVpZ2h0PSIxNiIgdmlld0JveD0iMCAwIDE1IDE2Ij4KICAgIDxwYXRoIGZpbGw9IiM1NUIyRjEiIGZpbGwtcnVsZT0iZXZlbm9kZCIgZD0iTTE0LjQ2OCAxMC4zMTJjLS4wMS0uOTU3LS4zOC0xLjQ3Ni0uODA3LTIuMTUzLS4xOTEtLjI4My0uNDEzLS40NzMtLjYwNS0uNzU1LS4wMy0uMTU0LjAzMy0uMjY4LS4wMTItLjY3MS0uMDQyLS42MDQtLjI2My0uODM4LS4zMS0uOTEyLjAyLS4xNi0uMDQzLTEuNDg1LS41MjMtMi4yNjhDMTAuNzUxLjk0MSA3Ljk4Mi44NDYgNy42NDMuODQ0SDcuNjRjLS4zMzkuMDAyLTMuMTA3LjA5Ny00LjU2OCAyLjcxLS40NzkuNzgyLS41NDMgMi4xMDYtLjUyMyAyLjI2Ny0uMDQ2LjA3NC0uMjY3LjMwOC0uMzEuOTEyLS4wNDQuNDAzLjAxOC41MTctLjAxMi42Ny0uMTkyLjI4NC0uNDEzLjQ3My0uNjA1Ljc1Ni0uNDI2LjY3Ny0uNzk3IDEuMTk2LS44MDYgMi4xNTMtLjAwNy43MTQuMTYyIDEuNjg3LjY2MyAxLjcuMTU4LS4wMTIuMjkyLS4xMTcuNTY2LS40MjQuMDgyLS4wOTIuMzctLjQ4LjQyOS0uNTg3LjA1Ni4xNDguMTkgMS4xODMgMS4xMiAxLjcyMy0uOTU2LjQ1LTEuNDI0LjczNS0xLjQ0IDEuMzE5LjAyLjMzOC40MjMuNzg3IDEuMTY1Ljk5NmE2LjA1IDYuMDUgMCAwIDAgMi45MjcuMDVjLjUzNS0uMTMuNjk2LS4yNiAxLjM5Ni0uNjQ0LjcuMzg1Ljg2LjUxNCAxLjM5NS42NDNhNi4wNTIgNi4wNTIgMCAwIDAgMi45MjctLjA0OWMuNzQyLS4yMDkgMS4xNDYtLjY1OCAxLjE2Ni0uOTk2LS4wMTYtLjU4NC0uNDg0LS44Ny0xLjQ0LTEuMzIuOTMtLjUzOCAxLjA2My0xLjU3NCAxLjEyLTEuNzIyLjA1OC4xMDcuMzQ2LjQ5NS40MjguNTg3LjI3NC4zMDcuNDA5LjQxMi41NjcuNDI0LjUtLjAxMy42Ny0uOTg2LjY2My0xLjd6Ii8+Cjwvc3ZnPgo=)}.panel-btn.wechat-btn[data-v-19356a56]{background-image:url(//s3.pstatp.com/toutiao/xitu_juejin_web/img/wechat.63e1ce0.svg)}.panel-btn.wechat-btn[data-v-19356a56]:hover{background-image:url(//s3.pstatp.com/toutiao/xitu_juejin_web/img/wechat-hover.c8ce019.svg)}.panel-btn.wechat-btn:hover .wechat-qr-code-img[data-v-19356a56]{display:block}.share-title[data-v-19356a56]{margin:2.5rem 0 1rem;font-size:1rem;text-align:center;color:#c6c6c6;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.wechat-qr-code-img[data-v-19356a56]{position:absolute;top:100%;left:50%;width:8rem;height:8rem;margin-top:1rem;border:.5rem solid #fff;transform:translateX(-50%);display:none}
.extension[data-v-7e9c74a6]{position:fixed;bottom:0;left:0;z-index:1000;width:100%;height:180px;cursor:pointer;display:none}.extension[data-v-7e9c74a6]:before{display:flex;width:100%;position:absolute;bottom:0;z-index:0;height:148px;z-index:-1;content:"";background-color:#fff}.extension .link[data-v-7e9c74a6]{width:100%;height:100%;color:#000;background-repeat:no-repeat;background-image:url(//s3.pstatp.com/toutiao/xitu_juejin_web/img/extension.c1307da.png);background-position:bottom;background-size:auto 180px;image-rendering:-webkit-optimize-contrast}.extension .link .price[data-v-7e9c74a6]{margin-left:5px;margin-right:5px;color:#007fff}.extension .link .description[data-v-7e9c74a6],.extension .link .title[data-v-7e9c74a6]{font-size:26px;padding-top:50px;box-sizing:border-box;width:960px;margin:0 auto;padding-left:22px}.extension .link .description[data-v-7e9c74a6]{color:rgba(0,0,0,.7);font-size:13px;padding-top:8px}.extension .ion-close[data-v-7e9c74a6]{position:absolute;top:45px;right:15px;font-size:12px;color:#bbb}.extension .ion-close[data-v-7e9c74a6]:hover{color:#999}.books[data-v-7e9c74a6]{display:none;left:15px;right:15px;position:fixed;bottom:15px;z-index:900}.books.book--mobile[data-v-7e9c74a6]{bottom:55px}.books .book-inner[data-v-7e9c74a6]{width:100%;height:50px;padding-left:15px;padding-right:15px;display:flex;justify-content:center;align-items:center;background:#fd4243;box-sizing:border-box;border-radius:2px;background:linear-gradient(108deg,#f87554,#f0232f);background:-webkit-linear-gradient(-12deg,#f87554,#f0232f)}.books .book-inner .icon[data-v-7e9c74a6]{width:38px}.books .book-inner .icon img[data-v-7e9c74a6]{width:100%;display:block}.books .book-inner .title[data-v-7e9c74a6]{flex-grow:1;padding-left:15px;color:#fff;font-size:15px}.books .book-inner .btn-get[data-v-7e9c74a6]{padding-left:15px;padding-right:15px;height:26px;line-height:26px;border-radius:2px;border:1px solid #fff;color:#fff}@media (max-width:960px){.books[data-v-7e9c74a6]{display:block}}@media (min-width:960px){.extension[data-v-7e9c74a6]{display:block}}</style>
  </head>
  <body >
    <div data-server-rendered="true" id="__nuxt"><div id="__layout"><div id="juejin"><div class="global-component-box"><!----> <!----> <!----> <!----> <!----> <div class="emoji-barrage" data-v-68506677><!----></div> <!----> <!----> <div class="bind-phone-number-modal-box" data-v-6217922a><div st:block="bindPhoneNumberModal" class="modal-mask" style="display:none;" data-v-6217922a data-v-6217922a></div> <form class="bind-phone-number-form" style="display:none;" data-v-6217922a data-v-6217922a><i title="关闭" class="close-btn ion-close-round" data-v-6217922a></i> <h1 class="title" data-v-6217922a>提示</h1> <h2 class="hint" data-v-6217922a>根据我国<a href="http://www.cac.gov.cn/2016-11/07/c_1119867116.htm" target="_blank" style="color:#007fff">《网络安全法》</a>，您需要绑定手机号后才可在掘金社区内发布内容。</h2> <div class="input-group" data-v-6217922a><div class="input-box dropdown-box" data-v-6217922a><div class="dropdown-input-container" style="width:26%;" data-v-4e5eda86 data-v-6217922a><div class="dropdown-input-box" data-v-4e5eda86><input autocomplete="off" value="86" data-v-4e5eda86> <img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMiIgaGVpZ2h0PSIxMiIgdmlld0JveD0iMCAwIDEyIDEyIj4KICAgIDxwYXRoIGZpbGw9IiM5OTkiIGZpbGwtcnVsZT0ibm9uemVybyIgZD0iTTYgNy42NTlsMy4xNDYtMy40OTZhLjQ2NS40NjUgMCAwIDEgLjcwOCAwIC42LjYgMCAwIDEgMCAuNzg1bC0zLjUgMy44OWEuNDY1LjQ2NSAwIDAgMS0uNzA4IDBsLTMuNS0zLjg5YS42LjYgMCAwIDEgMC0uNzg1LjQ2NS40NjUgMCAwIDEgLjcwOCAwTDYgNy42NTl6Ii8+Cjwvc3ZnPg==" class="arrow" style="transform:rotate(0deg);" data-v-4e5eda86></div> <div class="dropdown-pannel" style="display:none;" data-v-4e5eda86 data-v-4e5eda86><ul data-v-4e5eda86><li class="item selected" data-v-4e5eda86><span data-v-4e5eda86>中国</span> <span data-v-4e5eda86>+86</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>中国澳门</span> <span data-v-4e5eda86>+853</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>中国台湾</span> <span data-v-4e5eda86>+886</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>中国香港</span> <span data-v-4e5eda86>+852</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>阿尔巴尼亚</span> <span data-v-4e5eda86>+355</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>阿尔及利亚</span> <span data-v-4e5eda86>+213</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>阿根廷</span> <span data-v-4e5eda86>+54</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>阿拉伯联合酋长国</span> <span data-v-4e5eda86>+971</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>阿鲁巴岛</span> <span data-v-4e5eda86>+297</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>阿曼</span> <span data-v-4e5eda86>+968</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>阿塞拜疆</span> <span data-v-4e5eda86>+994</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>阿森松</span> <span data-v-4e5eda86>+247</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>埃及</span> <span data-v-4e5eda86>+20</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>埃塞俄比亚</span> <span data-v-4e5eda86>+251</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>爱尔兰</span> <span data-v-4e5eda86>+353</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>爱沙尼亚</span> <span data-v-4e5eda86>+372</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>安道尔</span> <span data-v-4e5eda86>+376</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>安哥拉</span> <span data-v-4e5eda86>+244</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>安圭拉</span> <span data-v-4e5eda86>+1264</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>安提瓜和巴布达</span> <span data-v-4e5eda86>+1268</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>奥地利</span> <span data-v-4e5eda86>+43</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>奥兰群岛</span> <span data-v-4e5eda86>+358</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>澳大利亚</span> <span data-v-4e5eda86>+61</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>巴巴多斯</span> <span data-v-4e5eda86>+1246</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>巴哈马</span> <span data-v-4e5eda86>+1242</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>巴拉圭</span> <span data-v-4e5eda86>+595</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>巴勒斯坦</span> <span data-v-4e5eda86>+970</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>巴林</span> <span data-v-4e5eda86>+973</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>巴拿马</span> <span data-v-4e5eda86>+507</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>巴西</span> <span data-v-4e5eda86>+55</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>白俄罗斯</span> <span data-v-4e5eda86>+375</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>百慕大</span> <span data-v-4e5eda86>+1441</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>保加利亚</span> <span data-v-4e5eda86>+359</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>北马里亚纳群岛</span> <span data-v-4e5eda86>+1670</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>贝宁</span> <span data-v-4e5eda86>+229</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>比利时</span> <span data-v-4e5eda86>+32</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>冰岛</span> <span data-v-4e5eda86>+354</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>波多黎各</span> <span data-v-4e5eda86>+1787</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>波黑</span> <span data-v-4e5eda86>+387</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>波兰</span> <span data-v-4e5eda86>+48</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>玻利维亚</span> <span data-v-4e5eda86>+591</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>伯利兹</span> <span data-v-4e5eda86>+501</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>博茨瓦纳</span> <span data-v-4e5eda86>+267</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>不丹</span> <span data-v-4e5eda86>+975</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>布基拉法索</span> <span data-v-4e5eda86>+226</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>布隆迪</span> <span data-v-4e5eda86>+257</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>朝鲜</span> <span data-v-4e5eda86>+850</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>赤道几内亚</span> <span data-v-4e5eda86>+240</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>丹麦</span> <span data-v-4e5eda86>+45</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>德国</span> <span data-v-4e5eda86>+49</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>多哥</span> <span data-v-4e5eda86>+228</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>多米尼加共和国</span> <span data-v-4e5eda86>+1809</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>多米尼克</span> <span data-v-4e5eda86>+1767</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>俄罗斯</span> <span data-v-4e5eda86>+7</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>厄瓜多尔</span> <span data-v-4e5eda86>+593</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>厄立特里亚</span> <span data-v-4e5eda86>+291</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>法国</span> <span data-v-4e5eda86>+33</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>法罗群岛</span> <span data-v-4e5eda86>+298</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>法属波利尼西亚</span> <span data-v-4e5eda86>+689</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>法属圭亚那</span> <span data-v-4e5eda86>+594</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>梵蒂冈</span> <span data-v-4e5eda86>+379</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>菲律宾</span> <span data-v-4e5eda86>+63</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>斐济</span> <span data-v-4e5eda86>+679</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>芬兰</span> <span data-v-4e5eda86>+358</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>佛得角</span> <span data-v-4e5eda86>+238</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>冈比亚</span> <span data-v-4e5eda86>+220</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>刚果</span> <span data-v-4e5eda86>+242</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>刚果民主共和国</span> <span data-v-4e5eda86>+243</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>哥伦比亚</span> <span data-v-4e5eda86>+57</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>哥斯达黎加</span> <span data-v-4e5eda86>+506</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>格林纳达</span> <span data-v-4e5eda86>+1473</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>格陵兰岛</span> <span data-v-4e5eda86>+299</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>格鲁吉亚</span> <span data-v-4e5eda86>+995</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>瓜德罗普</span> <span data-v-4e5eda86>+590</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>关岛</span> <span data-v-4e5eda86>+1671</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>圭亚那</span> <span data-v-4e5eda86>+592</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>海地</span> <span data-v-4e5eda86>+509</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>韩国</span> <span data-v-4e5eda86>+82</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>荷兰</span> <span data-v-4e5eda86>+31</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>荷属安的列斯</span> <span data-v-4e5eda86>+599</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>洪都拉斯</span> <span data-v-4e5eda86>+504</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>吉布提</span> <span data-v-4e5eda86>+253</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>加拿大</span> <span data-v-4e5eda86>+1</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>吉尔吉斯斯坦</span> <span data-v-4e5eda86>+996</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>几内亚</span> <span data-v-4e5eda86>+224</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>加那利群岛</span> <span data-v-4e5eda86>+3491</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>加纳</span> <span data-v-4e5eda86>+233</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>加蓬</span> <span data-v-4e5eda86>+241</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>柬埔寨</span> <span data-v-4e5eda86>+855</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>捷克</span> <span data-v-4e5eda86>+420</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>喀麦隆</span> <span data-v-4e5eda86>+237</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>卡塔尔</span> <span data-v-4e5eda86>+974</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>开曼群岛</span> <span data-v-4e5eda86>+1345</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>科摩罗</span> <span data-v-4e5eda86>+269</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>科索沃</span> <span data-v-4e5eda86>+883</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>科特迪瓦</span> <span data-v-4e5eda86>+225</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>科威特</span> <span data-v-4e5eda86>+965</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>克罗地亚</span> <span data-v-4e5eda86>+385</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>肯尼亚</span> <span data-v-4e5eda86>+254</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>拉脱维亚</span> <span data-v-4e5eda86>+371</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>莱索托</span> <span data-v-4e5eda86>+266</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>老挝</span> <span data-v-4e5eda86>+856</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>黎巴嫩</span> <span data-v-4e5eda86>+961</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>立陶宛</span> <span data-v-4e5eda86>+370</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>利比里亚</span> <span data-v-4e5eda86>+231</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>利比亚</span> <span data-v-4e5eda86>+218</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>列支敦士登</span> <span data-v-4e5eda86>+423</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>留尼旺岛</span> <span data-v-4e5eda86>+262</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>卢森堡</span> <span data-v-4e5eda86>+352</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>卢旺达</span> <span data-v-4e5eda86>+250</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>罗马尼亚</span> <span data-v-4e5eda86>+40</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>马达加斯加</span> <span data-v-4e5eda86>+261</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>马尔代夫</span> <span data-v-4e5eda86>+960</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>马耳他</span> <span data-v-4e5eda86>+356</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>马拉维</span> <span data-v-4e5eda86>+265</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>马来西亚</span> <span data-v-4e5eda86>+60</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>马里</span> <span data-v-4e5eda86>+223</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>马其顿</span> <span data-v-4e5eda86>+389</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>马绍尔群岛</span> <span data-v-4e5eda86>+692</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>马提尼克</span> <span data-v-4e5eda86>+596</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>马约特</span> <span data-v-4e5eda86>+262</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>毛里求斯</span> <span data-v-4e5eda86>+230</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>毛里塔尼亚</span> <span data-v-4e5eda86>+222</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>美国</span> <span data-v-4e5eda86>+1</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>美属萨摩亚</span> <span data-v-4e5eda86>+1684</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>美属维尔京群岛</span> <span data-v-4e5eda86>+1340</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>蒙古</span> <span data-v-4e5eda86>+976</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>蒙塞拉特岛</span> <span data-v-4e5eda86>+1664</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>蒙特內哥羅</span> <span data-v-4e5eda86>+382</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>孟加拉国</span> <span data-v-4e5eda86>+880</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>秘鲁</span> <span data-v-4e5eda86>+51</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>密克罗尼西亚联邦</span> <span data-v-4e5eda86>+691</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>缅甸</span> <span data-v-4e5eda86>+95</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>摩尔多瓦</span> <span data-v-4e5eda86>+373</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>摩洛哥</span> <span data-v-4e5eda86>+212</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>摩纳哥</span> <span data-v-4e5eda86>+377</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>莫桑比克</span> <span data-v-4e5eda86>+258</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>墨西哥</span> <span data-v-4e5eda86>+52</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>纳米比亚</span> <span data-v-4e5eda86>+264</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>南非</span> <span data-v-4e5eda86>+27</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>尼泊尔</span> <span data-v-4e5eda86>+977</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>尼加拉瓜</span> <span data-v-4e5eda86>+505</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>尼日尔</span> <span data-v-4e5eda86>+227</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>尼日利亚</span> <span data-v-4e5eda86>+234</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>挪威</span> <span data-v-4e5eda86>+47</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>帕劳</span> <span data-v-4e5eda86>+680</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>葡萄牙</span> <span data-v-4e5eda86>+351</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>千里达及托巴哥</span> <span data-v-4e5eda86>+1868</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>日本</span> <span data-v-4e5eda86>+81</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>瑞典</span> <span data-v-4e5eda86>+46</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>瑞士</span> <span data-v-4e5eda86>+41</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>圣诞岛</span> <span data-v-4e5eda86>+61</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>圣基茨和尼维斯</span> <span data-v-4e5eda86>+1869</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>圣卢西亚</span> <span data-v-4e5eda86>+1758</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>圣马力诺</span> <span data-v-4e5eda86>+223</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>圣马力诺</span> <span data-v-4e5eda86>+378</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>圣皮埃尔和密克隆群岛</span> <span data-v-4e5eda86>+508</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>圣文森特和格林纳丁斯</span> <span data-v-4e5eda86>+1784</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>斯里兰卡</span> <span data-v-4e5eda86>+94</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>斯洛伐克</span> <span data-v-4e5eda86>+421</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>斯洛文尼亚</span> <span data-v-4e5eda86>+386</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>斯威士兰</span> <span data-v-4e5eda86>+268</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>苏丹</span> <span data-v-4e5eda86>+249</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>苏里南</span> <span data-v-4e5eda86>+597</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>索马里</span> <span data-v-4e5eda86>+252</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>塔吉克斯坦</span> <span data-v-4e5eda86>+992</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>沙特阿拉伯</span> <span data-v-4e5eda86>+966</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>塞舌尔</span> <span data-v-4e5eda86>+248</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>塞浦路斯</span> <span data-v-4e5eda86>+357</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>塞内加尔</span> <span data-v-4e5eda86>+221</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>塞拉利昂</span> <span data-v-4e5eda86>+232</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>塞尔维亚</span> <span data-v-4e5eda86>+381</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>萨尔瓦多</span> <span data-v-4e5eda86>+503</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>萨尔瓦多</span> <span data-v-4e5eda86>+503</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>汤加</span> <span data-v-4e5eda86>+676</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>坦桑尼亚</span> <span data-v-4e5eda86>+255</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>泰国</span> <span data-v-4e5eda86>+66</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>特克斯和凯科斯群岛</span> <span data-v-4e5eda86>+1649</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>突尼斯</span> <span data-v-4e5eda86>+216</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>图瓦卢</span> <span data-v-4e5eda86>+688</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>土库曼斯坦</span> <span data-v-4e5eda86>+993</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>乌兹别克斯坦</span> <span data-v-4e5eda86>+998</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>乌拉圭</span> <span data-v-4e5eda86>+598</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>乌克兰</span> <span data-v-4e5eda86>+380</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>乌干达</span> <span data-v-4e5eda86>+256</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>文莱</span> <span data-v-4e5eda86>+673</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>委内瑞拉</span> <span data-v-4e5eda86>+58</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>危地马拉</span> <span data-v-4e5eda86>+502</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>匈牙利</span> <span data-v-4e5eda86>+36</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>新西兰</span> <span data-v-4e5eda86>+64</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>新喀里多尼亚</span> <span data-v-4e5eda86>+687</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>新加坡</span> <span data-v-4e5eda86>+65</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>希腊</span> <span data-v-4e5eda86>+30</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>西萨摩亚</span> <span data-v-4e5eda86>+685</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>西撒哈拉</span> <span data-v-4e5eda86>+212</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>西班牙</span> <span data-v-4e5eda86>+34</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>越南</span> <span data-v-4e5eda86>+84</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>约旦</span> <span data-v-4e5eda86>+962</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>英属维尔京群岛</span> <span data-v-4e5eda86>+1284</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>英国</span> <span data-v-4e5eda86>+44</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>印度尼西亚</span> <span data-v-4e5eda86>+62</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>印度</span> <span data-v-4e5eda86>+91</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>意大利</span> <span data-v-4e5eda86>+39</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>以色列</span> <span data-v-4e5eda86>+972</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>伊朗</span> <span data-v-4e5eda86>+98</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>伊拉克</span> <span data-v-4e5eda86>+964</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>也门</span> <span data-v-4e5eda86>+967</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>亚美尼亚</span> <span data-v-4e5eda86>+374</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>牙买加</span> <span data-v-4e5eda86>+1876</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>中非</span> <span data-v-4e5eda86>+236</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>智利</span> <span data-v-4e5eda86>+56</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>直布罗陀</span> <span data-v-4e5eda86>+350</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>乍得</span> <span data-v-4e5eda86>+235</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>赞比亚</span> <span data-v-4e5eda86>+260</span></li></ul></div></div> <input maxlength="11" placeholder="请输入要绑定的手机号码" value="" class="input number-input" data-v-6217922a></div> <div class="input-box vcode-box" data-v-6217922a></div> <div class="input-box" data-v-6217922a><input maxlength="4" placeholder="验证码" value="" class="input" data-v-6217922a> <button class="send-vcode-btn" data-v-6217922a>
            获取验证码
          </button></div></div> <button st:name="bindBtn" class="btn" data-v-6217922a>
        绑定手机
      </button></form></div> <!----></div> <!----> <div class="view-container" data-v-6a3e47cf data-v-d6ec2d02><div class="main-header-box" data-v-6a3e47cf><header class="main-header main-header unauthorized visible" data-v-20709686 data-v-6a3e47cf><div class="container" data-v-20709686><a href="/" class="logo" data-v-20709686><img src="//s3.pstatp.com/toutiao/xitu_juejin_web/img/logo.a7995ad.svg" alt="掘金" class="logo-img" data-v-20709686> <img src="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+Cjxzdmcgd2lkdGg9IjQ1cHgiIGhlaWdodD0iMzhweCIgdmlld0JveD0iMCAwIDQ1IDM4IiB2ZXJzaW9uPSIxLjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiPgogICAgPHRpdGxlPkp1ZWppbjwvdGl0bGU+CiAgICA8ZGVzYz5KdWVqaW4uaW08L2Rlc2M+CiAgICA8ZGVmcz48L2RlZnM+CiAgICA8ZyBpZD0iMC4xIiBzdHJva2U9Im5vbmUiIHN0cm9rZS13aWR0aD0iMSIgZmlsbD0ibm9uZSIgZmlsbC1ydWxlPSJldmVub2RkIj4KICAgICAgICA8ZyBpZD0iR3JvdXAtMTQiIHRyYW5zZm9ybT0idHJhbnNsYXRlKDEuMDAwMDAwLCA1LjAwMDAwMCkiIGZpbGw9IiMwMDZDRkYiPgogICAgICAgICAgICA8cGF0aCBkPSJNMjEuMjkzNDMyOCwyLjU4MzEzMDQ5IEwxOC4wMTczOTg0LDAgTDE0LjU5NDYyNCwyLjY5ODg3ODAxIEwxNC40MTcyMDc3LDIuODQxODIzMDQgTDE4LjAxNzM5ODQsNS43MTI0MjQ4MyBMMjEuNjI4NjU3OCwyLjg0MTgyMzA0IEwyMS4yOTM0MzI4LDIuNTgzMTMwNDkgWiBNMzMuNzA3ODI4OSwxMi42MDA2Njc0IEwxOC4wMDc5MTA5LDI0Ljk4MDI3NiBMMi4zMTc0ODA0NCwxMi42MDgyNTc0IEwwLDE0LjQ2OTcwNTIgTDE4LjAwNzkxMDksMjguNjY5MDE2NyBMMzYuMDI1NjI1NiwxNC40NjIxMTUyIEwzMy43MDc4Mjg5LDEyLjYwMDY2NzQgWiBNMTguMDA3OTEwOSwxMy42MDUwNzc2IEw5LjQ2NDQxNTU0LDYuODY4NjM1MDUgTDcuMTQ2NjE4ODUsOC43MzAwODI5IEwxOC4wMDc5MTA5LDE3LjI5NDEzNDUgTDI4Ljg3ODM3NDIsOC43MjI0OTI5IEwyNi41NjA1Nzc1LDYuODYxMDQ1MDUgTDE4LjAwNzkxMDksMTMuNjA1MDc3NiBaIiBpZD0iRmlsbC0xLUNvcHkiPjwvcGF0aD4KICAgICAgICA8L2c+CiAgICA8L2c+Cjwvc3ZnPg==" alt="掘金" class="mobile" data-v-20709686></a> <nav role="navigation" class="main-nav" data-v-20709686><ul class="nav-list" data-v-20709686><li class="main-nav-list" data-v-20709686><div class="phone-show-menu" data-v-20709686><span data-v-20709686>首页</span> <div class="icon ion-arrow-down-b" data-v-20709686></div></div> <ul class="phone-hide" data-v-20709686><li class="nav-item link-item route-active" data-v-20709686><a href="/" data-v-20709686>首页</a></li> <li class="nav-item link-item activities" data-v-20709686><a href="/pins" data-v-20709686>沸点</a></li> <li class="nav-item link-item" data-v-20709686><a href="/topics" data-v-20709686>话题</a></li> <li class="nav-item link-item book" data-v-20709686><a href="/books" data-v-20709686>小册</a></li> <li class="nav-item link-item" data-v-20709686><a href="/events/all" data-v-20709686>活动</a></li></ul></li> <li class="nav-item search" data-v-20709686><form role="search" class="search-form" data-v-20709686><input type="search" maxlength="32" placeholder="探索掘金" value="" class="search-input" data-v-20709686> <img src="//s3.pstatp.com/toutiao/xitu_juejin_web/img/juejin-search-icon.6f8ba1b.svg" alt="搜索" class="search-icon" data-v-20709686></form></li> <li class="nav-item add" data-v-20709686><div class="add-group" data-v-20709686><button class="add-btn" data-v-20709686>写文章</button> <div class="more" data-v-20709686><i class="more-icon ion-android-arrow-dropdown" data-v-20709686></i></div> <ul class="more-list" data-v-20709686><li class="item" data-v-20709686>发布沸点</li> <!----></ul></div> <!----></li> <!----> <!----> <li class="nav-item auth" data-v-20709686><button class="login-button" data-v-20709686>登录</button></li></ul></nav></div></header></div>  <main class="container main-container" style="max-width:;" data-v-6a3e47cf><div class="view column-view" data-v-6a3e47cf data-v-d6ec2d02><div class="main-area article-area shadow" data-v-6a3e47cf data-v-d6ec2d02><article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="6864381092061773831" data-draft-id="6864379334061195278" class="article" data-v-d6ec2d02><!----> <meta itemprop="headline" content=" 微前端“容器”——microcosmos实现"> <meta itemprop="keywords" content="前端框架"> <meta itemprop="datePublished" content="2020-08-24T03:05:02.000Z"> <meta itemprop="image" content="https://b-gold-cdn.xitu.io/icon/icon-128.png"> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Ethanlv_吹风机"> <meta itemprop="url" content="https://juejin.im/user/1688448856764088"></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://b-gold-cdn.xitu.io/icon/icon-white-180.png"> <meta itemprop="width" content="180"> <meta itemprop="height" content="180"></div></div> <div class="author-info-block" data-v-d6ec2d02><a href="/user/1688448856764088" target="_blank" rel="" class="avatar-link" data-v-d6ec2d02><div data-src="https://sf1-ttcdn-tos.pstatp.com/img/user-avatar/22c47e28b80d07d43845d5cba74aa9ff~120x256.image" class="lazy avatar avatar" style="background-image:none;" data-v-47cc2604 data-v-1c418ef0 data-v-d6ec2d02></div></a> <div class="author-info-box" data-v-d6ec2d02><!----> <div class="meta-box" data-v-d6ec2d02><time datetime="2020-08-24T03:05:02.000Z" title="Mon Aug 24 2020 11:05:02 GMT+0800 (China Standard Time)" class="time" data-v-d6ec2d02>
                  2020年08月24日
                </time> <span class="views-count" data-v-d6ec2d02>阅读 4115</span> <!----></div></div> <button class="follow-button follow" data-v-06c7d5b3 data-v-d6ec2d02><span data-v-06c7d5b3>关注</span></button></div> <div data-src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/7488827d17a746e98766e708e04015db~tplv-k3u1fbpfcp-zoom-1.image" class="lazy thumb article-hero" style="background-image:none;background-size:cover;" data-v-47cc2604 data-v-7b344634 data-v-d6ec2d02></div> <!----> <h1 class="article-title" data-v-d6ec2d02> 微前端“容器”——microcosmos实现</h1> <div itemprop="articleBody" class="article-content" data-v-d6ec2d02><div class="markdown-body"><blockquote>
<p>本文内容是自己对微前端的一些浅见以及对最近写的一个微前端框架技术实现的总结。作者水平有限，欢迎大家多多指错，多提意见~
源码地址：<a href="https://github.com/chuifengji/microcosmos" target="_blank" rel="nofollow noopener noreferrer">microcosmos：一个写着玩的微前端框架</a></p>
<p>然后谢谢大家的star，pr当然就更欢迎了~</p>
</blockquote>
<h2 data-id="heading-0">微前端是什么</h2>
<p>​       我第一次听说微前端这个概念是在一年前左右偶然看到了美团的一篇技术博客：<a href="https://tech.meituan.com/2018/09/06/fe-tiny-spa.html" target="_blank" rel="nofollow noopener noreferrer">用微前端的方式搭建单页应用</a>。然而那时候我连单页面应用是什么都还不知道，自然是看的一头雾水了。目前大家普遍认为微前端的概念由<strong>ThoughtWorks</strong>在2016年提出。四年的时间，飞速发展，目前我们已经能看到很多优秀的开源作品，如<a href="https://github.com/single-spa/single-spa" target="_blank" rel="nofollow noopener noreferrer"><strong>single-spa</strong></a>、<a href="https://qiankun.umijs.org/zh" target="_blank" rel="nofollow noopener noreferrer"><strong>qiankun</strong></a>、<a href="https://github.com/ice-lab/icestark" target="_blank" rel="nofollow noopener noreferrer">icestark</a>、<a href="https://github.com/neuland/micro-frontends" target="_blank" rel="nofollow noopener noreferrer">Micro Frontends</a> etc.</p>
<p>​        那微前端到底是什么呢？其实换个问题会更好的帮助我们认识：<strong>为什么需要微前端？</strong></p>
<p>​        你可能不知道微前端，但你应该知道微服务。</p>
<p>维基百科上的解释是这样的：</p>
<blockquote>
<p>微服务是一种软件开发技术- 面向服务的体系结构（SOA）架构样式的一种变体，将应用程序构造为一组松散耦合的服务。在微服务体系结构中，服务是细粒度的，协议是轻量级的微服务是一种以业务功能为主的服务设计概念，每一个服务都具有自主运行的业务功能，对外开放不受语言限制的 API (最常用的是 HTTP)，应用程序则是由一个或多个微服务组成。</p>
</blockquote>
<p>​      说白了微服务的出现主要是为了解决单体应用过于庞大过于复杂带来的一系列问题。微前端亦然。当大家发现传统的SPA在不断的迭代中慢慢进化成了巨石应用，使得应用的开发、部署、维护都变得异常困难。我们就迫切的需要一种方式将前端应用进行拆分，以此来分解复杂度。</p>
<p>​       又或者单纯的分久必合合久必分罢了？</p>
<p>​       我想，这个时候你一定想到了另一个概念，<strong>组件化</strong>。那微前端和组件化开发有什么区别呢？和组件化的区别？我觉得它们的设计思想都是一样的，包括前面说的微服务。在以前，我们提出组件化开发的概念，但它在我们如今的期望面前不够用了。诚然组件化的主要目的是追求更好的可复用和维护性，这点和微前端类似。但它对应用拆分的粒度是组件。微前端则是将<strong>前端应用分解成能够独立开发、测试、部署的子应用，而在用户看来仍然是内聚的单个产品</strong>，粒度是app，并且，因为独立开发，我们期望<strong>技术栈无关</strong>，这是非常重要的。我还没有工作经验，在这方面难谈太多，qiankun开发者的这篇文章很好的回答了为什么技术栈无关在微前端中如此重要。<a href="https://zhuanlan.zhihu.com/p/95085796" target="_blank" rel="nofollow noopener noreferrer">微前端的核心价值</a></p>
<p> 理想的微前端是什么样呢？和声的观点我蛮赞同，那就是<strong>子工程是不知道自己是作为子工程在工作的</strong>。不过应用间通信的场景还是有的，不然大家也不会总是强调父子通信了。</p>
<p>为了实现我们的愿景，我们需要将多个独立的前端应用集成到一起，实现的方式当然有很多。</p>
<p>从前端的角度来说，主要是两种。构建时集成和运行时集成。</p>
<p>构建时集成，也就是代码分割。什么意思呢，我们可以把不同的app放到一起开发，给webpack配置多个入口，最后打包生成多个出口文件，以实现代码分割。这种方式目前来说只是看上去可行，但是没办法上沙箱，而且你还是没有实现独立开发，独立部署。</p>
<p>运行时集成主要是两种方案。一种，我想大家肯定都知道，iframe。实际上，如果不考虑用户体验，我觉得iframe就是一个完美的微前端方案。但是没办法，iframe带来的问题，使得我们没办法优先考虑它。比如iframe每次都会重新加载，在移动端兼容性差，并且还需要服务端帮忙，不然会有跨域问题。</p>
<p>在这里，我们要谈的是另一种方案，即实现一种容器，容器承载着主应用，通过在主应用中注册子应用的方式来实现微前端。</p>
<p>​      下面是我用<strong>microcosmos</strong>写的一个微前端demo，主应用中包含了一个vue app和react app。</p>
<p></p><figure><img class="lazyload" data-src="//p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/751b40da50dd41f489805d8e5c5cf449~tplv-k3u1fbpfcp-zoom-1.image" data-width="800" data-height="600"><figcaption></figcaption></figure><p></p>
<p>我想你应该已经知道微前端是什么了。接下来，让我们看看microcosmos的技术实现。</p>
<h2 data-id="heading-1">Microcosmos实现</h2>
<h3 data-id="heading-2">整体架构</h3>
<p>咕咕咕，下面这张图就是microcosmos的架构了，整体的架构很简单，你从对应的表情能看出来我对各个部分实现的满意程度。下面分别介绍。</p>
<p></p><figure><img class="lazyload" data-src="//p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/68f22cf589814a70a513d18bd8218788~tplv-k3u1fbpfcp-zoom-1.image" data-width="800" data-height="600"><figcaption></figcaption></figure><p></p>
<h3 data-id="heading-3">相关API</h3>
<p><strong>引入</strong></p>
<p><code>npm i microcosmos</code></p>
<pre><code class="hljs language-typescript copyable" lang="typescript"><span class="hljs-keyword">import</span> { start, register,initCosmosStore } <span class="hljs-keyword">from</span> <span class="hljs-string">'microcosmos'</span>;
<span class="copy-code-btn">复制代码</span></code></pre>
<p><strong>注册子应用</strong></p>
<pre><code class="hljs language-typescript copyable" lang="typescript">register([
  {
    name: <span class="hljs-string">'sub-react'</span>,
    entry: <span class="hljs-string">"http://localhost:3001"</span>,
    container: <span class="hljs-string">"sub-react"</span>,
    matchRouter: <span class="hljs-string">"/sub-react"</span>
  },
  {
    name: <span class="hljs-string">'sub-vue'</span>,
    entry: <span class="hljs-string">"http://localhost:3002"</span>,
    container: <span class="hljs-string">"sub-vue"</span>,
    matchRouter: <span class="hljs-string">"/sub-vue"</span>
  }
])

<span class="copy-code-btn">复制代码</span></code></pre>
<p><strong>开始</strong></p>
<pre><code class="hljs language-typescript copyable" lang="typescript">start()
<span class="copy-code-btn">复制代码</span></code></pre>
<p><strong>主应用路由方式</strong></p>
<pre><code class="hljs language-jsx copyable" lang="jsx"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">App</span>(<span class="hljs-params"></span>) </span>{
 <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">goto</span>(<span class="hljs-params">title, href</span>) </span>{
  <span class="hljs-built_in">window</span>.history.pushState(href, title, href);
 }
 <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&#x3C;<span class="hljs-name">div</span>></span>
   </span>&#x3C;nav>
    &#x3C;ol>
     &#x3C;li onClick={(e) => goto('sub-vue', '/sub-vue')}>子应用一&#x3C;/li>
     &#x3C;li onClick={(e) => goto('sub-react', '/sub-react')}>子应用二&#x3C;/li>
    &#x3C;/ol>
   &#x3C;/nav><span class="xml">
      </span>&#x3C;div id="sub-vue">&#x3C;/div><span class="xml">
      </span>&#x3C;div id="sub-react">&#x3C;/div><span class="xml">
  <span class="hljs-tag">&#x3C;/<span class="hljs-name">div</span>></span></span>
 )
}
<span class="copy-code-btn">复制代码</span></code></pre>
<p><strong>子应用必须导出生命周期钩子函数</strong></p>
<p><code>bootstrap、mount、unmount</code></p>
<pre><code class="hljs language-typescript copyable" lang="typescript"><span class="hljs-keyword">export</span> <span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">bootstrap</span>(<span class="hljs-params"></span>) </span>{
  <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'react bootstrap'</span>)
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">mount</span>(<span class="hljs-params"></span>) </span>{
  <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'react mount'</span>)
  ReactDOM.render(&#x3C;App />, <span class="hljs-built_in">document</span>.getElementById(<span class="hljs-string">'app-react'</span>))
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">unmount</span>(<span class="hljs-params"></span>) </span>{
  <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'react unmout'</span>)
  <span class="hljs-keyword">let</span> root = <span class="hljs-built_in">document</span>.getElementById(<span class="hljs-string">'sub-react'</span>);
  root.innerHTML = <span class="hljs-string">''</span>
}

<span class="copy-code-btn">复制代码</span></code></pre>
<p><strong>全局状态通信/存储</strong></p>
<p>应用之间通信的场景是有，但绝大多数情况下数据量少，频度低，所以全局Store设计的也很简单。</p>
<p>在主应用中：</p>
<ul>
<li>
<p>initCosmosStore:初始化store</p>
</li>
<li>
<p>subscribeStore:监听store变化</p>
</li>
<li>
<p>changeStore：给store派发新值</p>
</li>
<li>
<p>getStore：获取store当前快照</p>
</li>
</ul>
<pre><code class="hljs language-typescript copyable" lang="typescript"><span class="hljs-keyword">let</span> store = initCosmosStore({ name: <span class="hljs-string">'chuifengji'</span> })

store.subscribeStore(<span class="hljs-function">(<span class="hljs-params">newValue, oldValue</span>) =></span> {

  <span class="hljs-built_in">console</span>.log(newValue, oldValue);

})

store.changeStore({ name: <span class="hljs-string">'wzx'</span> })

store.getStore();

<span class="copy-code-btn">复制代码</span></code></pre>
<p>在子应用中：</p>
<pre><code class="hljs language-typescript copyable" lang="typescript"><span class="hljs-keyword">export</span> <span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">mount</span>(<span class="hljs-params">rootStore</span>) </span>{

  rootStore.subscribeStore(<span class="hljs-function">(<span class="hljs-params">newValue, oldValue</span>) =></span> {
    <span class="hljs-built_in">console</span>.log(newValue, oldValue);
  }
  
  rootStore.changeStore({ name: <span class="hljs-string">'xjp'</span> }).then(<span class="hljs-function"><span class="hljs-params">res</span> =></span> <span class="hljs-built_in">console</span>.log(res))
  
  rootStore.getStore();
  
  instance = <span class="hljs-keyword">new</span> Vue({
    router,
    store,
    render: <span class="hljs-function"><span class="hljs-params">h</span> =></span> h(App)
  }).$mount(<span class="hljs-string">'#app-vue'</span>)
}

<span class="copy-code-btn">复制代码</span></code></pre>
<h3 data-id="heading-4">html-loader</h3>
<p>html-loader是通过获取页面的html,来获取app的信息，相对的一种方法是JS-loader,Js-loader和子应用的耦合性要高一点，子应用得和主应用约定好承载容器不是。</p>
<p>那html-loader是如何工作的呢？其实很简单，就是通过应用的入口地址，如：http://localhost:3001, 再调用fetch函数。获取到html的text格式信息后，我们需要从中取出我们需要的部分挂载到子应用承载点上。下面这张图是上面那个微前端demo的element结构。你可以看到子应用被挂在<strong>id为sub-react</strong>的标签下。</p>
<p></p><figure><img class="lazyload" data-src="//p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/7fd7c97419024d39b1a0c5c0546c419d~tplv-k3u1fbpfcp-zoom-1.image" data-width="800" data-height="600"><figcaption></figcaption></figure><p></p>
<p>如何来做呢？</p>
<p>我想你的第一反应可能是正则，我一开始也是用正则来处理的，但是我后来发现，正则太难完备了（原谅我这个正则盲）我总能写出示例让我自己的正则导出错误的结果。并且用正则来写，代码看着确实挺乱的，后期维护也不太方便。既然是html字符串，为什么我们不用dom api来处理呢?第一反应又是iframe,直接新建一个iframe，利用src属性加载iframe。问题来了，我怎么知道iframe什么时候加载好了？onload吗，显然不行，我们只是为了取出数据而已。<strong>DOMContentLoaded</strong>？像下面这样，写一个ready函数，还是不行，<strong>DOMContentLoaded</strong>会等待js执行完才回调。对SPA来说，这时间可能有点长了。</p>
<pre><code class="hljs language-js copyable" lang="js"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">iframeReady</span>(<span class="hljs-params">iframe: HTMLIFrameElement, iframeName: string</span>): <span class="hljs-title">Promise</span>&#x3C;<span class="hljs-title">Document</span>> </span>{
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Promise</span>(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">resolve, reject</span>) </span>{
        <span class="hljs-built_in">window</span>.frames[iframeName].addEventListener(<span class="hljs-string">'DOMContentLoaded'</span>, () => {
            <span class="hljs-keyword">let</span> html = iframe.contentDocument || (iframe.contentWindow <span class="hljs-keyword">as</span> Window).document;
            resolve(html);
        });
    });
}
<span class="copy-code-btn">复制代码</span></code></pre>
<p>没办法，只好想别的办法，写定时函数来判断dom中是否存在body节点，通过适当调整定时函数的执行周期，好像可以，但我们无法知道子应用的结构，依赖于body还是不行的，太不可靠了。</p>
<pre><code class="hljs language-typescript copyable" lang="typescript"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">iframeReady</span>(<span class="hljs-params">iframe: HTMLIFrameElement</span>): <span class="hljs-title">Promise</span>&#x3C;<span class="hljs-title">Document</span>> </span>{
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Promise</span>(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">resolve, reject</span>) </span>{
        (<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">isiframeReady</span>(<span class="hljs-params"></span>) </span>{
            <span class="hljs-keyword">if</span> (iframe.contentDocument.body || (iframe.contentWindow <span class="hljs-keyword">as</span> Window).document.body) {
                resolve(iframe.contentDocument || (iframe.contentWindow <span class="hljs-keyword">as</span> Window).document)
            } <span class="hljs-keyword">else</span> {
                setInterval(isiframeReady, <span class="hljs-number">10</span>)
            }
        })()
    })
}
<span class="copy-code-btn">复制代码</span></code></pre>
<p>而且要获取到iframe的<code>contentWindow</code>的话你需要将iframe挂在到dom上，确实，可以设置为<code>display:none</code>，但太不优雅了。怎么看怎么不舒服。</p>
<p><code>srcdoc</code>?是个不错的选择，可惜IE不支持这个新属性。</p>
<p>那就将正则和DOM API结合吧。我们通过正则获取head和body节点下的内容，这两个正则还是挺容易完备的，再将它们<code>innerHtml</code>到<code>createElement</code>出的一个div节点中，通过DOM API来遍历。DOM的结构是稳定的，我们可以轻松可靠的获取我们想要的内容，即html结构信息和js。</p>
<h3 data-id="heading-5">js隔离</h3>
<p><strong>微前端沙箱没有完美实践？</strong></p>
<p>微前端中既然存在多个独立开发的应用，自然需要隔离js，采取的方式是构建沙箱。在浏览器当中，沙箱隔离了操作系统和浏览器渲染引擎，限制进程对操作系统资源的访问和修改。实际上，如果我们需要的app需要执行一些信任度不高的外部js的时候你也是需要沙箱的。一般情况下，我们说的沙箱强调的是两层，隔离和安全。js沙箱本身是个蛮大的坑，好在大部分情况下代码安全都不是微前端要考虑的问题，主应用对接入的子应用不能信任这样的情况还是比较少。微前端中的沙箱要考虑的是第一层，完全的隔离反而会带来问题。</p>
<p>如果不考虑全局对象，不考虑DOM和BOM，我们要做的事情其实非常简单。使用new Function,这样子应用之间的变量都运行在函数作用域中，自然不会冲突了，但是我们还是得考虑全局变量，考虑DOM和BOM。特别是那些个框架大多都改了原生对象。那我们如何实现window的隔离呢？</p>
<p>主要的思路有三种：</p>
<p><strong>快照沙箱：</strong></p>
<p>快照沙箱实际上就是在应用mount时激活生成快照，在unmount时失活恢复原有环境。比如app A挂载时修改了一个全局变量<code>window.appName = 'vue'</code>,那我就可以记录下当前的快照（修改前的属性值）。当app A卸载时，我就可以把当前的快照和当前环境进行比对，获知原有环境从而恢复运行环境。</p>
<pre><code class="hljs language-typescript copyable" lang="typescript"><span class="hljs-keyword">class</span> SnapshotSandbox {
    <span class="hljs-keyword">constructor</span>(<span class="hljs-params"></span>) {
        <span class="hljs-keyword">this</span>.proxy = <span class="hljs-built_in">window</span>; 
        <span class="hljs-keyword">this</span>.modifyPropsMap = {}; <span class="hljs-comment">// 修改了哪些属性</span>
        <span class="hljs-keyword">this</span>.active();
    }
    active() {
        <span class="hljs-keyword">this</span>.windowSnapshot = {}; <span class="hljs-comment">// window对象的快照</span>
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> prop <span class="hljs-keyword">in</span> <span class="hljs-built_in">window</span>) {
            <span class="hljs-keyword">if</span> (<span class="hljs-built_in">window</span>.hasOwnProperty(prop)) {
                <span class="hljs-comment">// 将window上的属性进行拍照</span>
                <span class="hljs-keyword">this</span>.windowSnapshot[prop] = <span class="hljs-built_in">window</span>[prop];
            }
        }
        <span class="hljs-built_in">Object</span>.keys(<span class="hljs-keyword">this</span>.modifyPropsMap).forEach(<span class="hljs-function"><span class="hljs-params">p</span> =></span> {
            <span class="hljs-built_in">window</span>[p] = <span class="hljs-keyword">this</span>.modifyPropsMap[p];
        });
    }
    inactive() {
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> prop <span class="hljs-keyword">in</span> <span class="hljs-built_in">window</span>) { <span class="hljs-comment">// diff 差异</span>
            <span class="hljs-keyword">if</span> (<span class="hljs-built_in">window</span>.hasOwnProperty(prop)) {
                <span class="hljs-comment">// 将上次拍照的结果和本次window属性做对比</span>
                <span class="hljs-keyword">if</span> (<span class="hljs-built_in">window</span>[prop] !== <span class="hljs-keyword">this</span>.windowSnapshot[prop]) {
                    <span class="hljs-comment">// 保存修改后的结果</span>
                    <span class="hljs-keyword">this</span>.modifyPropsMap[prop] = <span class="hljs-built_in">window</span>[prop]; 
                    <span class="hljs-comment">// 还原window</span>
                    <span class="hljs-built_in">window</span>[prop] = <span class="hljs-keyword">this</span>.windowSnapshot[prop]; 
                }
            }
        }
    }
}

<span class="hljs-keyword">let</span> sandbox = <span class="hljs-keyword">new</span> SnapshotSandbox();
<span class="hljs-function">(<span class="hljs-params">(<span class="hljs-params"><span class="hljs-built_in">window</span></span>) => {
    <span class="hljs-built_in">window</span>.a = 1;
    <span class="hljs-built_in">window</span>.b = 2;
    <span class="hljs-built_in">window</span>.c = 3
    <span class="hljs-built_in">console</span>.log(<span class="hljs-params">a,b,c</span>)
    sandbox.inactive(<span class="hljs-params"></span>);
    <span class="hljs-built_in">console</span>.log(<span class="hljs-params">a,b,c</span>)
}</span>)(<span class="hljs-params">sandbox.proxy</span>);
</span><span class="copy-code-btn">复制代码</span></code></pre>
<p>快照沙箱的思路很简单，也很容易做到子应用的状态保持，但是显然快照沙箱只能支持单实例的场景，对于多实例共存的场景，它就无能为力了。</p>
<p><strong>借用iframe:</strong></p>
<p>啊这个，也太没逼格了。开玩笑，其实iframe也不好做，虽然我们通过它可以拿到完全隔离的 <code>window</code>、<code>document</code> 等上下文。但还是不能直接加以使用的，你得通过<code>postMessage</code>,建立iframe和主应用之间的通信。不然路由啥的还玩个锤子。</p>
<p><strong>proxy代理:</strong></p>
<pre><code class="hljs language-typescript copyable" lang="typescript"><span class="hljs-keyword">class</span> ProxySandbox {
    <span class="hljs-keyword">constructor</span>(<span class="hljs-params"></span>) {
        <span class="hljs-keyword">const</span> rawWindow = <span class="hljs-built_in">window</span>;
        <span class="hljs-keyword">const</span> fakeWindow = {}
        <span class="hljs-keyword">const</span> proxy = <span class="hljs-keyword">new</span> Proxy(fakeWindow, {
            <span class="hljs-keyword">set</span>(target, p, value) {
                target[p] = value;
                <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>
            },
            <span class="hljs-keyword">get</span>(target, p) {
                <span class="hljs-keyword">return</span> target[p] || rawWindow[p];
            }
        });
        <span class="hljs-keyword">this</span>.proxy = proxy
    }
}
<span class="hljs-keyword">let</span> sandbox1 = <span class="hljs-keyword">new</span> ProxySandbox();
<span class="hljs-keyword">let</span> sandbox2 = <span class="hljs-keyword">new</span> ProxySandbox();
<span class="hljs-built_in">window</span>.a = <span class="hljs-number">1</span>;
<span class="hljs-function">(<span class="hljs-params">(<span class="hljs-params"><span class="hljs-built_in">window</span></span>) => {
    <span class="hljs-built_in">window</span>.a = {a:'ldl'};
    <span class="hljs-built_in">console</span>.log(<span class="hljs-params"><span class="hljs-built_in">window</span>.a</span>)
}</span>)(<span class="hljs-params">sandbox1.proxy</span>);<span class="hljs-params">a</span>:'<span class="hljs-params">ldl</span>'
(<span class="hljs-params">(<span class="hljs-params"><span class="hljs-built_in">window</span></span>) => {
    <span class="hljs-built_in">window</span>.a = 'world';
    <span class="hljs-built_in">console</span>.log(<span class="hljs-params"><span class="hljs-built_in">window</span>.a</span>)
}</span>)(<span class="hljs-params">sandbox2.proxy</span>);
</span><span class="copy-code-btn">复制代码</span></code></pre>
<p>上面这个proxy是很简单了，读时优先获取"拷贝值"，没有就代理到原值，写时代理到“拷贝值”。但它存在着诸多问题，且不说各种恶意代码，如果全局对象使用self、this、globalThis，代理就无效了，只代理get和set也是不够的。最重要的，只是在一定程度上隔离了全局变量而已，window的原生对象和方法，全部失效。</p>
<pre><code class="hljs language-typescript copyable" lang="typescript"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getOwnPropertyDescriptors</span>(<span class="hljs-params">target: <span class="hljs-built_in">any</span></span>) </span>{
    <span class="hljs-keyword">const</span> res: <span class="hljs-built_in">any</span> = {}
    Reflect.ownKeys(target).forEach(<span class="hljs-function"><span class="hljs-params">key</span> =></span> {
        res[key] = <span class="hljs-built_in">Object</span>.getOwnPropertyDescriptor(target, key)
    })
    <span class="hljs-keyword">return</span> res
}


<span class="hljs-keyword">export</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">copyProp</span>(<span class="hljs-params">target: <span class="hljs-built_in">any</span>, source: <span class="hljs-built_in">any</span></span>) </span>{
    <span class="hljs-keyword">if</span> (<span class="hljs-built_in">Array</span>.isArray(target)) {
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &#x3C; source.length; i++) {
            <span class="hljs-keyword">if</span> (!(i <span class="hljs-keyword">in</span> target)) {
                target[i] = source[i];
            }
        }
    }
    <span class="hljs-keyword">else</span> {
        <span class="hljs-keyword">const</span> descriptors = getOwnPropertyDescriptors(source)
        <span class="hljs-comment">//delete descriptors[DRAFT_STATE as any]</span>
        <span class="hljs-keyword">let</span> keys = Reflect.ownKeys(descriptors)
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &#x3C; keys.length; i++) {
            <span class="hljs-keyword">const</span> key: <span class="hljs-built_in">any</span> = keys[i]
            <span class="hljs-keyword">const</span> desc = descriptors[key]
            <span class="hljs-keyword">if</span> (desc.writable === <span class="hljs-literal">false</span>) {
                desc.writable = <span class="hljs-literal">true</span>
                desc.configurable = <span class="hljs-literal">true</span>
            }
            <span class="hljs-keyword">if</span> (desc.get || desc.set)
                descriptors[key] = {
                    configurable: <span class="hljs-literal">true</span>,
                    writable: <span class="hljs-literal">true</span>, 
                    enumerable: desc.enumerable,
                    value: source[key]
                }
        }
        target = <span class="hljs-built_in">Object</span>.create(<span class="hljs-built_in">Object</span>.getPrototypeOf(source), descriptors)
        <span class="hljs-built_in">console</span>.log(target)
    }
}

<span class="hljs-keyword">export</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">copyOnWrite</span>(<span class="hljs-params">draftState: {
    originalValue: {
        [key: <span class="hljs-built_in">string</span>]: <span class="hljs-built_in">any</span>;
    };
    draftValue: <span class="hljs-built_in">any</span>;
    onWrite: <span class="hljs-built_in">any</span>;
    mutated: <span class="hljs-built_in">boolean</span>;
}</span>) </span>{
    <span class="hljs-keyword">const</span> { originalValue, draftValue, mutated, onWrite } = draftState;
    <span class="hljs-keyword">if</span> (!mutated) {
        draftState.mutated = <span class="hljs-literal">true</span>;
        <span class="hljs-keyword">if</span> (onWrite) {
            onWrite(draftValue);
        }
        copyProp(draftValue, originalValue);
    }
}

<span class="copy-code-btn">复制代码</span></code></pre>
<p>沙箱难做的原因是，是因为有矛盾点，那就是我们既希望能做到尽可能的隔离，但你又不应当做到完全的隔离。在这个界限之间，就会有冲突。</p>
<p>microcosmos的沙箱就是用proxy实现的，目前的做法是通过copy-on-write实现部分window部分下对象的拷贝，window下的方法还是bind到原方法上的，这个确实没什么好办法。如果怕造成冲突，可以通过添加黑白名单的方式，限制子应用对某些方法的访问，或者自己模拟实现一些方法，再进行通信。不管哪种方案，都不够优雅。</p>
<p>我对这个部分的实现很不满意， 代码参考自<code>immer</code>，这个库实在有太多可以借鉴的东西。</p>
<p>感兴趣的可以自己研究下：<a href="https://github.com/immerjs/immer" target="_blank" rel="nofollow noopener noreferrer">immer</a></p>
<h3 data-id="heading-6">css隔离</h3>
<p><strong>我们需要在微前端容器设计中考虑隔离CSS吗？</strong></p>
<p>其实我个人觉得这不是微前端容器要考虑的内容，因为这个问题和微前端无关，几乎是在有css起，我们就在遭遇这样的问题，SPA时代更是已经成了必须要考虑的问题。所以在microcosmos中我没有去解决css隔离的问题。你依然要像开发SPA一样，采取 BEM(Block Element Modifier)  约定项目前缀,css module,css-in-js等方案。</p>
<p>而像qiankun所说的 <strong>Dynamic Stylesheet</strong>其实蛮无聊的（我自己也加了hh），子应用的装卸自然包含着css的装卸，但是这不能保证子应用与主应用之间没有冲突，更不用说还可能存在多个子应用并行的情况。(当然了，他们现在也提出了其他方案，值得期待！）</p>
<p>那你可能会说，Why not shadow dom?</p>
<p>shadow dom确实天生隔离样式，我们很多的开源组件库都使用了shadow dom。但是要把整个应用挂在shadow dom风险还是太大了。会出现各种各样的问题。</p>
<p>比如React17之前，为了减少 DOM 上的事件对象来节省内存，优化页面性能，同时也为了实现事件调度机制，所有的事件都代理到document元素上。 而<code>shadow dom</code> 里触发的事件，在外层拿到 <code>event.target </code>的时候，只会拿到 host(宿主元素)，所以导致了 react 的事件调度出现问题。</p>
<p></p><figure><img class="lazyload" data-src="//p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/bd7b397a2b924f5aa3fa3525cd9879df~tplv-k3u1fbpfcp-zoom-1.image" data-width="800" data-height="600"><figcaption></figcaption></figure><p></p>
<p>如果你不了解react，我解释一下。</p>
<p>在React 的「合成事件机制」中「事件」并不会直接绑定到具体的 DOM 元素上，而是通过在 document 上绑定的 <code>ReactEventListener </code>来管理， 当时元素被单击或触发其他事件时，事件被 dispatch 到 document 时将由 React 进行处理并触发相应合成事件的执行。</p>
<p>对于shadow dom，因为主文档内部的脚本并不了解 shadow dom 内部，尤其是当组件来自于第三方库，所以，为了保持细节简单，浏览器会<strong>重新定位</strong>（retarget）事件。<strong>当事件在组件外部捕获时，shadow DOM 中发生的事件将会以 host 元素作为目标</strong>。</p>
<p>这将让 React 在处理合成事件时，不认为 ShadowDOM 中元素基于 JSX 语法绑定的事件被触发了。</p>
<p>当然了，更大的问题是shadow dom只是隔离了内部与外部，内部还是会有冲突的可能呀。</p>
<h3 data-id="heading-7">life-cycle</h3>
<p><strong>生命周期循环是个大遍历。</strong></p>
<p>每次路由发生有效改变的时候我们需要触发<code>lifeCycle</code>，对已经注册的app进行遍历，该卸载的卸载，该注入的注入。</p>
<p>lifeCycle会遍历子应用列表，依次执行它们的生命周期函数，这里有个小问题，子应用的生命周期函数是如何被主应用获取到的，如果你和我一样不熟悉webpack，或许会陷入这样的困惑，事实上，webpack以<code>umd</code>格式进行打包的话，require函数会将export出的函数合成一个model挂到window上。这样我们就可以获取啦。</p>
<p>本身倒没有什么问题，只是我写的lifeCycle，对于应用状态依赖有点弱。。比如说，第一次进入某个子应用需要fetch，后面就不应需要了。我的做法是通过函数缓存来实现，但是整个生命周期的执行没有丝毫变化，这样似乎不太好，不够优雅。</p>
<p>这里倒是有个要补充的点，我们希望用户的点击触发<code>window.history.pushState</code>事件，以此来显式的改变地址栏url，但是我们还需要对pushSate进行监听来触发函数切换应用。pushState又是没法被直接监听的，我们需要对window.history.pushState事件进行包装，通过监听自定义事件来监听history变化，下面是实现函数。</p>
<pre><code class="hljs language-typescript copyable" lang="typescript"><span class="hljs-keyword">export</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">patchEventListener</span>(<span class="hljs-params">event: <span class="hljs-built_in">any</span>, ListerName: <span class="hljs-built_in">string</span></span>) </span>{
    <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"><span class="hljs-keyword">this</span>: <span class="hljs-built_in">any</span></span>) </span>{
        <span class="hljs-keyword">const</span> e = <span class="hljs-keyword">new</span> Event(ListerName);
        event.apply(<span class="hljs-keyword">this</span>, <span class="hljs-built_in">arguments</span>)
        <span class="hljs-built_in">window</span>.dispatchEvent(e);
    };
}
<span class="hljs-built_in">window</span>.history.pushState = patchEventListener(<span class="hljs-built_in">window</span>.history.pushState, <span class="hljs-string">"cosmos_pushState"</span>);
<span class="hljs-built_in">window</span>.addEventListener(<span class="hljs-string">"cosmos_pushState"</span>, routerChange);
<span class="copy-code-btn">复制代码</span></code></pre>
<h3 data-id="heading-8">应用通信</h3>
<p><strong>需求决定实现。</strong></p>
<p>理想的微前端可能都不需要这个设计，因为我们说了，子应用是不知道自己是作为子应用在运行的，但是毕竟只是理想。我们还是会有一些父子通信的需求。一般情况下，在微前端中，父子应用之间，子应用之间的通信频度较低，数据量较小。</p>
<p>所以在<strong>microcosmos</strong> 里我只是运用了简单的发布订阅来实现。靠，你这也太简单了吧。（别骂了别骂了，能用就行</p>
<pre><code class="hljs language-typescript copyable" lang="typescript"><span class="hljs-keyword">export</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">initCosmosStore</span>(<span class="hljs-params">initData</span>) </span>{
    <span class="hljs-keyword">return</span> <span class="hljs-built_in">window</span>.MICROCOSMOS_ROOT_STORE = (<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
        <span class="hljs-keyword">let</span> store = initData;
        <span class="hljs-keyword">let</span> observers: <span class="hljs-built_in">Array</span>&#x3C;<span class="hljs-built_in">Function</span>> = [];
        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getStore</span>(<span class="hljs-params"></span>) </span>{
            <span class="hljs-keyword">return</span> store;
        }
        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">changeStore</span>(<span class="hljs-params">newValue</span>) </span>{
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =></span> {
                <span class="hljs-keyword">if</span> (newValue !== store) {
                    <span class="hljs-keyword">let</span> oldValue = store;
                    store = newValue;
                    resolve(store);
                    observers.forEach(<span class="hljs-function"><span class="hljs-params">fn</span> =></span> fn(newValue, oldValue));
                }
            })
        }
        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">subscribeStore</span>(<span class="hljs-params">fn</span>) </span>{
            observers.push(fn);
        }
        <span class="hljs-keyword">return</span> { getStore, changeStore, subscribeStore }
    })()
}
<span class="copy-code-btn">复制代码</span></code></pre>
<h3 data-id="heading-9">预加载</h3>
<p>预加载是为了降低白屏时间，获取更流畅的应用切换效果，对于一些通过微前端实现的工作台，主应用上可能注册了十几个甚至更多的子应用，我们往往不会在短时间内都执行它们，那通过预加载，就能够提前抓取子应用的数据信息，让微前端的优势发挥到极致。</p>
<p>要注意的是浏览器同域名下的并发请求数量是有限制的，不同浏览器可能都不太一样，比如在chrome上可能是6，所以我们需要对子应用列表进行切片，再通过promise 链式调用。	</p>
<p>至此，microcosmos的技术实现就讲完啦，当然还是有些小细节，没法全部来讲。</p>
<h2 data-id="heading-10">总结</h2>
<p>微前端的架构虽然看起来简单，但如果真的要做一个高可用的版本，还有很多的路要走，相信未来我们会有更完善的一整套微前端工程化方案，而不是局限于容器。</p>
<p></p><figure><img class="lazyload" data-src="//p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/6e641fb4db124b008907f6e69cd5afc1~tplv-k3u1fbpfcp-zoom-1.image" data-width="800" data-height="600"><figcaption></figcaption></figure><p></p>
<p>PS:即将发布的webpack5的特性之一<a href="https://richlab.design/translations/2020/03/27/webpack-5-module-federation" target="_blank" rel="nofollow noopener noreferrer">module federation</a>使得JavaScript 应用得以从另一个 JavaScript 应用中动态地加载代码 —— 同时共享依赖。如果某应用所消费的 federated module 没有 federated code 中所需的依赖，Webpack 将会从 federated 构建源中下载缺少的依赖项， webpack能够更好更方便地支持不同工程之间构建产物的互相加载，让我们一起看看这最终会给微前端带来什么。</p>
<h2 data-id="heading-11">引用</h2>
<ul>
<li>
<p><a href="">微服务概念</a></p>
</li>
<li>
<p><a href="https://martinfowler.com/articles/micro-frontends.html" target="_blank" rel="nofollow noopener noreferrer">Micro Frontends</a></p>
</li>
<li>
<p><a href="http://www.ayqy.net/blog/new%E4%B8%80%E4%B8%AAimmer/" target="_blank" rel="nofollow noopener noreferrer">new 一个 immer by ayqy</a></p>
</li>
<li>
<p><a href="https://richlab.design/translations/2020/03/27/webpack-5-module-federation" target="_blank" rel="nofollow noopener noreferrer">Module Federation</a></p>
</li>
</ul></div> <div class="image-viewer-box" data-v-78c9b824><!----></div></div></article> <!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----></div> <!----> <!----> <div class="article-suspended-panel article-suspended-panel" data-v-19356a56 data-v-d6ec2d02><div badge="42" class="like-btn panel-btn like-adjust with-badge" data-v-19356a56></div> <div badge="6" class="comment-btn panel-btn comment-adjust with-badge" data-v-19356a56></div> <div class="collect-btn panel-btn" data-v-19356a56><!----></div> <div class="share-title" data-v-19356a56>分享</div> <div class="weibo-btn share-btn panel-btn" data-v-19356a56></div> <div class="qq-btn share-btn panel-btn" data-v-19356a56></div> <div class="wechat-btn share-btn panel-btn" data-v-19356a56><img src="" class="wechat-qr-code-img shadow" style="display:none;" data-v-19356a56></div></div></div></main></div> <!----></div></div></div><script>window.__NUXT__=(function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s){return {layout:"default",data:[{}],fetch:[],error:b,state:{view:{activityIndex:{activityList:[],pageInfo:{hasNextPage:a,endCursor:e},afterPosition:e,activityListIsLoading:c,activityListIsError:a,userActivityList:[],placeholder:e,actionType:{FETCH:"@\u002Fview\u002Factivity-index\u002FFETCH",FETCH_RECOMMEND_LIST:"@\u002Fview\u002Factivity-index\u002FFETCH_RECOMMEND_LIST",RESET_ACTIVITY_LIST:"@\u002Fview\u002Factivity-index\u002FRESET_ACTIVITY_LIST",FETCH_USER_ACTIVITY_LIST:"@\u002Fview\u002Factivity-index\u002FFETCH_USER_ACTIVITY_LIST",FETCH_NEW_COUNT:"@\u002Fview\u002Factivity-index\u002FFETCH_NEW_COUNT",DELETE_ACTIVITY:"@\u002Fview\u002Factivity-index\u002FDELETE_ACTIVITY",TOGGLE_FOLLOW_USER:"@\u002Fview\u002Factivity-index\u002FTOGGLE_FOLLOW_USER",FETCH_ENTRY_COMMENT_LIST:"@\u002Fview\u002Factivity-index\u002FFETCH_ENTRY_COMMENT_LIST",UPDATE_LIST_LOADING:"@\u002Fview\u002Factivity-index\u002FUPDATE_LIST_LOADING",RESET:"@\u002Fview\u002Factivity-index\u002FRESET"},hotList:{list:[],after:e,loading:a,hasNextPage:a,actionType:{UPDATE_STATE:"@\u002Fview\u002Factivity-index\u002Fhot-list\u002FUPDATE_STATE",FETCH_MORE:"@\u002Fview\u002Factivity-index\u002Fhot-list\u002FFETCH_MORE",FETCH:"@\u002Fview\u002Factivity-index\u002Fhot-list\u002FFETCH",RESET:"@\u002Fview\u002Factivity-index\u002Fhot-list\u002FRESET"}},sidebar:{bannerList:[],actionType:{RESET:"@\u002Fview\u002Factivity-index\u002Fsidebar\u002FRESET",UPDATE_STATE:"@\u002Fview\u002Factivity-index\u002Fsidebar\u002FUPDATE_STATE",FETCH_BANNER:"@\u002Fview\u002Factivity-index\u002Fsidebar\u002FFETCH_BANNER"},recommend:{pageSize:g,page:d,total:d,pointer:b,lastPointer:b,list:[],loading:a,error:b,canPrev:c,canNext:c,linkList:[],lastFetchOnServer:a,actionType:{UPDATE:"@\u002Fview\u002Factivity-index\u002Fsidebar\u002Frecommend-topic-list\u002FUPDATE",FETCH:"@\u002Fview\u002Factivity-index\u002Fsidebar\u002Frecommend-topic-list\u002FFETCH",FORCE_FETCH:"@\u002Fview\u002Factivity-index\u002Fsidebar\u002Frecommend-topic-list\u002FFORCE_FETCH",FETCH_MORE:"@\u002Fview\u002Factivity-index\u002Fsidebar\u002Frecommend-topic-list\u002FFETCH_MORE",RESET:"@\u002Fview\u002Factivity-index\u002Fsidebar\u002Frecommend-topic-list\u002FRESET"},after:d},followed:{pageSize:g,page:d,total:d,pointer:b,lastPointer:b,list:[],loading:a,error:b,canPrev:c,canNext:c,linkList:[],lastFetchOnServer:a,actionType:{UPDATE:"@\u002Fview\u002Factivity-index\u002Fsidebar\u002Ffollowed-topic-list\u002FUPDATE",FETCH:"@\u002Fview\u002Factivity-index\u002Fsidebar\u002Ffollowed-topic-list\u002FFETCH",FORCE_FETCH:"@\u002Fview\u002Factivity-index\u002Fsidebar\u002Ffollowed-topic-list\u002FFORCE_FETCH",FETCH_MORE:"@\u002Fview\u002Factivity-index\u002Fsidebar\u002Ffollowed-topic-list\u002FFETCH_MORE",RESET:"@\u002Fview\u002Factivity-index\u002Fsidebar\u002Ffollowed-topic-list\u002FRESET"},after:d},recommendPin:{list:[],after:e,loading:a,hasNextPage:c,actionType:{UPDATE_STATE:"@\u002Fview\u002Factivity-index\u002Fsidebar\u002Frecommend-pin-list\u002FUPDATE_STATE",FETCH_MORE:"@\u002Fview\u002Factivity-index\u002Fsidebar\u002Frecommend-pin-list\u002FFETCH_MORE",FETCH:"@\u002Fview\u002Factivity-index\u002Fsidebar\u002Frecommend-pin-list\u002FFETCH",RESET:"@\u002Fview\u002Factivity-index\u002Fsidebar\u002Frecommend-pin-list\u002FRESET"}}},topicPinList:{pageSize:g,page:h,total:d,pointer:b,lastPointer:b,list:[],loading:a,error:b,canPrev:c,canNext:c,linkList:[],lastFetchOnServer:a,actionType:{UPDATE:"@\u002Fview\u002Factivity-index\u002Ftopic-pin-list\u002FUPDATE",FETCH:"@\u002Fview\u002Factivity-index\u002Ftopic-pin-list\u002FFETCH",FORCE_FETCH:"@\u002Fview\u002Factivity-index\u002Ftopic-pin-list\u002FFORCE_FETCH",FETCH_MORE:"@\u002Fview\u002Factivity-index\u002Ftopic-pin-list\u002FFETCH_MORE",RESET:"@\u002Fview\u002Factivity-index\u002Ftopic-pin-list\u002FRESET"},topicId:e,navList:[{type:j,name:j,title:"推荐 ",id:j},{type:k,name:k,title:"热门 ",id:k},{type:l,name:l,title:"关注 ",id:l},{type:i,name:"opensource",title:"开源推荐 ",id:"5c09ea2b092dcb42c740fe73"},{type:i,name:"recruitment",title:"内推招聘",id:"5abb61e1092dcb4620ca3322"},{type:i,name:"dating",title:"掘金相亲",id:"5abcaa67092dcb4620ca335c"},{type:i,name:"slacking",title:"上班摸鱼",id:"5c106be9092dcb2cc5de7257"},{type:i,name:"app",title:"应用安利",id:"5b514af1092dcb61bd72800d"},{type:i,name:"tool",title:"开发工具",id:"5abb67d2092dcb4620ca3324"},{type:i,name:"news",title:"New资讯",id:"5c46a17f092dcb4737217152"}],sortType:m}},search:{list:[],linkList:[],query:e,period:n,type:n,loading:a,skeleton:a,actionType:{FETCH:"@\u002Fview\u002Fsearch\u002FFETCH",FETCH_MORE:"@\u002Fview\u002Fsearch\u002FFETCH_MORE",RESET:"@\u002Fview\u002Fsearch\u002FRESET"}},columnIndex:{list:{pageSize:g,page:h,total:d,pointer:b,lastPointer:b,list:[],loading:a,error:b,canPrev:c,canNext:c,linkList:[],lastFetchOnServer:a,actionType:{UPDATE:"@\u002Fview\u002FcolumnIndex\u002Flist\u002FUPDATE",FETCH:"@\u002Fview\u002FcolumnIndex\u002Flist\u002FFETCH",FORCE_FETCH:"@\u002Fview\u002FcolumnIndex\u002Flist\u002FFORCE_FETCH",FETCH_MORE:"@\u002Fview\u002FcolumnIndex\u002Flist\u002FFETCH_MORE",RESET:"@\u002Fview\u002FcolumnIndex\u002Flist\u002FRESET"},sort:o,category:n},hotList:{pageSize:g,page:h,total:d,pointer:b,lastPointer:b,list:[],loading:a,error:b,canPrev:c,canNext:c,linkList:[],lastFetchOnServer:a,actionType:{UPDATE:"@\u002Fview\u002FcolumnIndex\u002FhotList\u002FUPDATE",FETCH:"@\u002Fview\u002FcolumnIndex\u002FhotList\u002FFETCH",FORCE_FETCH:"@\u002Fview\u002FcolumnIndex\u002FhotList\u002FFORCE_FETCH",FETCH_MORE:"@\u002Fview\u002FcolumnIndex\u002FhotList\u002FFETCH_MORE",RESET:"@\u002Fview\u002FcolumnIndex\u002FhotList\u002FRESET"}}},timelineIndex:{categoryNavList:[],tagNavList:[],splitTagList:[],timelineAdList:[],list:[],sort:m,category:j,categoryId:e,tagId:e,tag:"全部",actionType:{FETCH_TIMELINE_LIST:"@\u002Fview\u002FtimelineIndex\u002FFETCH_TIMELINE_LIST",FETCH_CATEGORY_LIST:"@\u002Fview\u002FtimelineIndex\u002FFETCH_CATEGORY_LIST",FETCH_TAG_LIST:"@\u002Fview\u002FtimelineIndex\u002FFETCH_TAG_LIST",DELETE_ENTRY:"@\u002Fview\u002FtimelineIndex\u002FDELETE_ENTRY",FETCH_MORE:"@\u002Fview\u002FtimelineIndex\u002FFETCH_MORE",FETCH:"@\u002Fview\u002FtimelineIndex\u002FFETCH",RESET:"@\u002Fview\u002FtimelineIndex\u002FRESET"},timelineList:{list:[],cursor:f,skeleton:a,loading:a,hasMore:a,categoryId:e,tagId:e,sort:e,actionType:{UPDATE_STATE:"timeline-list\u002FUPDATE_STATE",FETCH_MORE:"timeline-list\u002FFETCH_MORE",FETCH:"timeline-list\u002FFETCH",RESET:"timeline-list\u002FRESET"}},recommendList:{list:[],cursor:f,loading:a,hasMore:a,skeleton:a,actionType:{UPDATE_STATE:"recommend-list\u002FUPDATE_STATE",FETCH_MORE:"recommend-list\u002FFETCH_MORE",FETCH:"recommend-list\u002FFETCH",RESET:"recommend-list\u002FRESET"}},followingList:{list:[],cursor:f,skeleton:a,loading:a,hasMore:c,actionType:{UPDATE_STATE:"following-list\u002FUPDATE_STATE",FETCH_MORE:"following-list\u002FFETCH_MORE",FETCH:"following-list\u002FFETCH",RESET:"following-list\u002FRESET"}}},subscribe:{subscribed:{list:[],cursor:f,skeleton:c,loading:a,hasMore:a,actionType:{UPDATE_STATE:"view\u002Fsubscribe\u002Fsubscribed\u002Flist\u002FUPDATE_STATE",FETCH_MORE:"view\u002Fsubscribe\u002Fsubscribed\u002Flist\u002FFETCH_MORE",FETCH:"view\u002Fsubscribe\u002Fsubscribed\u002Flist\u002FFETCH",RESET:"view\u002Fsubscribe\u002Fsubscribed\u002Flist\u002FRESET"}},all:{list:[],cursor:f,loading:a,skeleton:c,hasMore:a,linkList:e,actionType:{UPDATE_STATE:"view\u002Fsubscribe\u002Fall\u002Flist\u002FUPDATE_STATE",FETCH_MORE:"view\u002Fsubscribe\u002Fall\u002Flist\u002FFETCH_MORE",FETCH:"view\u002Fsubscribe\u002Fall\u002Flist\u002FFETCH",RESET:"view\u002Fsubscribe\u002Fall\u002Flist\u002FRESET"}}},entryPublic:{entry:{user:{}},relatedEntryList:[],relatedCollectionList:[],actionType:{FETCH:"@\u002Fview\u002FentryPublic\u002FFETCH",RESET:"@\u002Fview\u002FentryPublic\u002FRESET"}},user:{user:{},actionType:{FETCH:"@\u002Fview\u002Fuser\u002FFETCH",RESET:"@\u002Fview\u002Fuser\u002FRESET",UPDATE:"@\u002Fview\u002Fuser\u002FUPDATE"},detailList:{actionType:{RESET:"@\u002Fview\u002Fuser\u002FdetailList\u002FRESET"},likeList:{list:[],cursor:f,hasMore:a,loading:a,skeleton:c,actionType:{FETCH:"@\u002Fview\u002Fuser\u002FdetailList\u002FlikePostList\u002FFETCH",UPDATE_STATE:"@\u002Fview\u002Fuser\u002FdetailList\u002FlikePostList\u002FUPDATE_STATE",FETCH_MORE:"@\u002Fview\u002Fuser\u002FdetailList\u002FlikePostList\u002FFETCH_MORE",RESET:"@\u002Fview\u002Fuser\u002FdetailList\u002FlikePostList\u002FRESET"}},postList:{list:[],hasMore:a,skeleton:a,loading:a,sort:o,actionType:{FETCH:"@\u002Fview\u002Fuser\u002FdetailList\u002FpostList\u002FFETCH",UPDATE_STATE:"@\u002Fview\u002Fuser\u002FdetailList\u002FpostList\u002FUPDATE_STATE",FETCH_MORE:"@\u002Fview\u002Fuser\u002FdetailList\u002FpostList\u002FFETCH_MORE",RESET:"@\u002Fview\u002Fuser\u002FdetailList\u002FpostList\u002FRESET"}},tagList:{list:[],loading:a,skeleton:c,hasMore:a,cursor:f,actionType:{FETCH:"@\u002Fview\u002Fuser\u002FdetailList\u002FtagList\u002FFETCH",UPDATE_STATE:"@\u002Fview\u002Fuser\u002FdetailList\u002FtagList\u002FUPDATE_STATE",FETCH_MORE:"@\u002Fview\u002Fuser\u002FdetailList\u002FtagList\u002FFETCH_MORE",RESET:"@\u002Fview\u002Fuser\u002FdetailList\u002FtagList\u002FRESET"}},collectionList:{list:[],userId:e,skeleton:c,hasMore:a,cursor:f,type:"created",loading:a,actionType:{FETCH:"@\u002Fview\u002Fuser\u002FdetailList\u002FcollectionList\u002FFETCH",UPDATE_STATE:"@\u002Fview\u002Fuser\u002FdetailList\u002FcollectionList\u002FUPDATE_STATE",FETCH_MORE:"@\u002Fview\u002Fuser\u002FdetailList\u002FcollectionList\u002FFETCH_MORE",RESET:"@\u002Fview\u002Fuser\u002FdetailList\u002FcollectionList\u002FRESET"}},followerList:{list:[],cursor:f,hasMore:a,loading:a,skeleton:a,actionType:{FETCH:"@\u002Fview\u002Fuser\u002FdetailList\u002FfollowerList\u002FFETCH",UPDATE_STATE:"@\u002Fview\u002Fuser\u002FdetailList\u002FfollowerList\u002FUPDATE_STATE",FETCH_MORE:"@\u002Fview\u002Fuser\u002FdetailList\u002FfollowerList\u002FFETCH_MORE",RESET:"@\u002Fview\u002Fuser\u002FdetailList\u002FfollowerList\u002FRESET"}},followingList:{list:[],cursor:f,hasMore:a,skeleton:a,loading:a,actionType:{FETCH:"@\u002Fview\u002Fuser\u002FdetailList\u002FfollowingList\u002FFETCH",UPDATE_STATE:"@\u002Fview\u002Fuser\u002FdetailList\u002FfollowingList\u002FUPDATE_STATE",FETCH_MORE:"@\u002Fview\u002Fuser\u002FdetailList\u002FfollowingList\u002FFETCH_MORE",RESET:"@\u002Fview\u002Fuser\u002FdetailList\u002FfollowingList\u002FRESET"}},activityList:{list:[],cursor:f,hasMore:a,loading:a,skeleton:a,actionType:{FETCH:"@\u002Fview\u002Fuser\u002FdetailList\u002FactivityList\u002FFETCH",UPDATE_STATE:"@\u002Fview\u002Fuser\u002FdetailList\u002FactivityList\u002FUPDATE_STATE",FETCH_MORE:"@\u002Fview\u002Fuser\u002FdetailList\u002FactivityList\u002FFETCH_MORE",RESET:"@\u002Fview\u002Fuser\u002FdetailList\u002FactivityList\u002FRESET"}},bookList:{list:[],cursor:f,skeleton:c,hasMore:a,loading:a,type:"bought",actionType:{FETCH:"@\u002Fview\u002Fuser\u002FdetailList\u002FbookList\u002FFETCH",UPDATE_STATE:"@\u002Fview\u002Fuser\u002FdetailList\u002FbookList\u002FUPDATE_STATE",FETCH_MORE:"@\u002Fview\u002Fuser\u002FdetailList\u002FbookList\u002FFETCH_MORE",RESET:"@\u002Fview\u002Fuser\u002FdetailList\u002FbookList\u002FRESET"}},pinList:{list:[],hasMore:a,loading:a,skeleton:c,actionType:{FETCH:"@\u002Fview\u002Fuser\u002FdetailList\u002FpinList\u002FFETCH",UPDATE_STATE:"@\u002Fview\u002Fuser\u002FdetailList\u002FpinList\u002FUPDATE_STATE",FETCH_MORE:"@\u002Fview\u002Fuser\u002FdetailList\u002FpinList\u002FFETCH_MORE",RESET:"@\u002Fview\u002Fuser\u002FdetailList\u002FpinList\u002FRESET"}},pinPraisedList:{list:[],cursor:f,hasMore:a,loading:a,skeleton:c,actionType:{FETCH:"@\u002Fview\u002Fuser\u002FdetailList\u002FpinPraisedList\u002FFETCH",UPDATE_STATE:"@\u002Fview\u002Fuser\u002FdetailList\u002FpinPraisedList\u002FUPDATE_STATE",FETCH_MORE:"@\u002Fview\u002Fuser\u002FdetailList\u002FpinPraisedList\u002FFETCH_MORE",RESET:"@\u002Fview\u002Fuser\u002FdetailList\u002FpinPraisedList\u002FRESET"}}}},tag:{tag:{},actionType:{FETCH:"@\u002Fview\u002Ftag\u002FFETCH",FETCH_LIST:"@\u002Fview\u002Ftag\u002FFETCH_LIST",RESET:"@\u002Fview\u002Ftag\u002FRESET"},list:{list:[],cursor:f,loading:a,skeleton:a,hasMore:a,actionType:{UPDATE_STATE:"@\u002Fview\u002Ftag\u002Flist\u002FUPDATE_STATE",FETCH_MORE:"@\u002Fview\u002Ftag\u002Flist\u002FFETCH_MORE",FETCH:"@\u002Fview\u002Ftag\u002Flist\u002FFETCH",RESET:"@\u002Fview\u002Ftag\u002Flist\u002FRESET"}}},notification:{user:{actionType:{READ_ALL:"@\u002Fview\u002Fnotification\u002Fuser\u002FREAD_ALL",RESET:"@\u002Fview\u002Fnotification\u002Fuser\u002FRESET"},listState:{list:[],cursor:f,hasMore:a,isLoading:a,messageType:3,msgTotal:d,msgSubMap:{"1":d,"2":d,"3":d,"4":d}},list:{pageSize:g,page:h,total:d,pointer:b,lastPointer:b,list:[],loading:a,error:b,canPrev:c,canNext:c,linkList:[],lastFetchOnServer:a,actionType:{UPDATE:"@\u002Fview\u002Fnotification\u002Fuser\u002Flist\u002FUPDATE",FETCH:"@\u002Fview\u002Fnotification\u002Fuser\u002Flist\u002FFETCH",FORCE_FETCH:"@\u002Fview\u002Fnotification\u002Fuser\u002Flist\u002FFORCE_FETCH",FETCH_MORE:"@\u002Fview\u002Fnotification\u002Fuser\u002Flist\u002FFETCH_MORE",RESET:"@\u002Fview\u002Fnotification\u002Fuser\u002Flist\u002FRESET"}}},system:{actionType:{READ_ALL:"@\u002Fview\u002Fnotification\u002Fsystem\u002FREAD_ALL",RESET:"@\u002Fview\u002Fnotification\u002Fsystem\u002FRESET"},list:{pageSize:g,page:h,total:d,pointer:b,lastPointer:b,list:[],loading:a,error:b,canPrev:c,canNext:c,linkList:[],lastFetchOnServer:a,actionType:{UPDATE:"@\u002Fview\u002Fnotification\u002Fsystem\u002Flist\u002FUPDATE",FETCH:"@\u002Fview\u002Fnotification\u002Fsystem\u002Flist\u002FFETCH",FORCE_FETCH:"@\u002Fview\u002Fnotification\u002Fsystem\u002Flist\u002FFORCE_FETCH",FETCH_MORE:"@\u002Fview\u002Fnotification\u002Fsystem\u002Flist\u002FFETCH_MORE",RESET:"@\u002Fview\u002Fnotification\u002Fsystem\u002Flist\u002FRESET"}}}},column:{column:{id:q},entry:{id:q,screenshot:void 0,liked:a,article_id:q,article_info:{article_id:q,user_id:"1688448856764088",category_id:"6809637767543259144",tag_ids:[6809640402103042000],visible_level:d,link_url:e,cover_image:"https:\u002F\u002Fp1-juejin.byteimg.com\u002Ftos-cn-i-k3u1fbpfcp\u002F7488827d17a746e98766e708e04015db~tplv-k3u1fbpfcp-zoom-1.image",is_gfw:d,title:" 微前端“容器”——microcosmos实现",brief_content:"​ 我第一次听说微前端这个概念是在一年前左右偶然看到了美团的一篇技术博客：用微前端的方式搭建单页应用。然而那时候我连单页面应用是什么都还不知道，自然是看的一头雾水了。目前大家普遍认为微前端的概念由ThoughtWorks在2016年提出。四年的时间，飞速发展，目前我们已经能看到…",is_english:d,is_original:h,user_index:d,original_type:d,original_author:e,content:e,ctime:"1598238302",mtime:"1599009597",rtime:"1598254266",draft_id:"6864379334061195278",view_count:4115,collect_count:d,digg_count:42,comment_count:6,hot_index:253,is_hot:d,rank_index:.0122038,status:2,verify_status:h,audit_status:2,mark_content:"\n\u003E本文内容是自己对微前端的一些浅见以及对最近写的一个微前端框架技术实现的总结。作者水平有限，欢迎大家多多指错，多提意见~\n\u003E源码地址：[microcosmos：一个写着玩的微前端框架](https:\u002F\u002Fgithub.com\u002Fchuifengji\u002Fmicrocosmos)\n\u003E\n\u003E然后谢谢大家的star，pr当然就更欢迎了~\n\n## 微前端是什么\n\n​       我第一次听说微前端这个概念是在一年前左右偶然看到了美团的一篇技术博客：[用微前端的方式搭建单页应用](https:\u002F\u002Ftech.meituan.com\u002F2018\u002F09\u002F06\u002Ffe-tiny-spa.html)。然而那时候我连单页面应用是什么都还不知道，自然是看的一头雾水了。目前大家普遍认为微前端的概念由**ThoughtWorks**在2016年提出。四年的时间，飞速发展，目前我们已经能看到很多优秀的开源作品，如[**single-spa**](https:\u002F\u002Fgithub.com\u002Fsingle-spa\u002Fsingle-spa)、[**qiankun**](https:\u002F\u002Fqiankun.umijs.org\u002Fzh)、[icestark](https:\u002F\u002Fgithub.com\u002Fice-lab\u002Ficestark)、[Micro Frontends](https:\u002F\u002Fgithub.com\u002Fneuland\u002Fmicro-frontends) etc.\n\n​        那微前端到底是什么呢？其实换个问题会更好的帮助我们认识：**为什么需要微前端？**\n\n​        你可能不知道微前端，但你应该知道微服务。\n\n维基百科上的解释是这样的：\n\n\u003E微服务是一种软件开发技术- 面向服务的体系结构（SOA）架构样式的一种变体，将应用程序构造为一组松散耦合的服务。在微服务体系结构中，服务是细粒度的，协议是轻量级的微服务是一种以业务功能为主的服务设计概念，每一个服务都具有自主运行的业务功能，对外开放不受语言限制的 API (最常用的是 HTTP)，应用程序则是由一个或多个微服务组成。\n\n​      说白了微服务的出现主要是为了解决单体应用过于庞大过于复杂带来的一系列问题。微前端亦然。当大家发现传统的SPA在不断的迭代中慢慢进化成了巨石应用，使得应用的开发、部署、维护都变得异常困难。我们就迫切的需要一种方式将前端应用进行拆分，以此来分解复杂度。\n\n​       又或者单纯的分久必合合久必分罢了？\n\n​       我想，这个时候你一定想到了另一个概念，**组件化**。那微前端和组件化开发有什么区别呢？和组件化的区别？我觉得它们的设计思想都是一样的，包括前面说的微服务。在以前，我们提出组件化开发的概念，但它在我们如今的期望面前不够用了。诚然组件化的主要目的是追求更好的可复用和维护性，这点和微前端类似。但它对应用拆分的粒度是组件。微前端则是将**前端应用分解成能够独立开发、测试、部署的子应用，而在用户看来仍然是内聚的单个产品**，粒度是app，并且，因为独立开发，我们期望**技术栈无关**，这是非常重要的。我还没有工作经验，在这方面难谈太多，qiankun开发者的这篇文章很好的回答了为什么技术栈无关在微前端中如此重要。[微前端的核心价值](https:\u002F\u002Fzhuanlan.zhihu.com\u002Fp\u002F95085796)\n\n 理想的微前端是什么样呢？和声的观点我蛮赞同，那就是**子工程是不知道自己是作为子工程在工作的**。不过应用间通信的场景还是有的，不然大家也不会总是强调父子通信了。\n\n为了实现我们的愿景，我们需要将多个独立的前端应用集成到一起，实现的方式当然有很多。\n\n从前端的角度来说，主要是两种。构建时集成和运行时集成。\n\n构建时集成，也就是代码分割。什么意思呢，我们可以把不同的app放到一起开发，给webpack配置多个入口，最后打包生成多个出口文件，以实现代码分割。这种方式目前来说只是看上去可行，但是没办法上沙箱，而且你还是没有实现独立开发，独立部署。\n\n运行时集成主要是两种方案。一种，我想大家肯定都知道，iframe。实际上，如果不考虑用户体验，我觉得iframe就是一个完美的微前端方案。但是没办法，iframe带来的问题，使得我们没办法优先考虑它。比如iframe每次都会重新加载，在移动端兼容性差，并且还需要服务端帮忙，不然会有跨域问题。\n\n在这里，我们要谈的是另一种方案，即实现一种容器，容器承载着主应用，通过在主应用中注册子应用的方式来实现微前端。\n\n​      下面是我用**microcosmos**写的一个微前端demo，主应用中包含了一个vue app和react app。\n\n![](\u002F\u002Fp3-juejin.byteimg.com\u002Ftos-cn-i-k3u1fbpfcp\u002F751b40da50dd41f489805d8e5c5cf449~tplv-k3u1fbpfcp-zoom-1.image)\n\n我想你应该已经知道微前端是什么了。接下来，让我们看看microcosmos的技术实现。\n\n## Microcosmos实现\n\n### 整体架构\n\n咕咕咕，下面这张图就是microcosmos的架构了，整体的架构很简单，你从对应的表情能看出来我对各个部分实现的满意程度。下面分别介绍。\n\n![](\u002F\u002Fp3-juejin.byteimg.com\u002Ftos-cn-i-k3u1fbpfcp\u002F68f22cf589814a70a513d18bd8218788~tplv-k3u1fbpfcp-zoom-1.image)\n\n\n\n### 相关API\n\n**引入**\n\n`npm i microcosmos`\n\n```typescript\nimport { start, register,initCosmosStore } from 'microcosmos';\n```\n\n**注册子应用**\n\n```typescript\nregister([\n  {\n    name: 'sub-react',\n    entry: \"http:\u002F\u002Flocalhost:3001\",\n    container: \"sub-react\",\n    matchRouter: \"\u002Fsub-react\"\n  },\n  {\n    name: 'sub-vue',\n    entry: \"http:\u002F\u002Flocalhost:3002\",\n    container: \"sub-vue\",\n    matchRouter: \"\u002Fsub-vue\"\n  }\n])\n\n```\n\n**开始**\n\n```typescript\nstart()\n```\n\n**主应用路由方式**\n\n```jsx\nfunction App() {\n function goto(title, href) {\n  window.history.pushState(href, title, href);\n }\n return (\n    \u003Cdiv\u003E\n   \u003Cnav\u003E\n    \u003Col\u003E\n     \u003Cli onClick={(e) =\u003E goto('sub-vue', '\u002Fsub-vue')}\u003E子应用一\u003C\u002Fli\u003E\n     \u003Cli onClick={(e) =\u003E goto('sub-react', '\u002Fsub-react')}\u003E子应用二\u003C\u002Fli\u003E\n    \u003C\u002Fol\u003E\n   \u003C\u002Fnav\u003E\n      \u003Cdiv id=\"sub-vue\"\u003E\u003C\u002Fdiv\u003E\n      \u003Cdiv id=\"sub-react\"\u003E\u003C\u002Fdiv\u003E\n  \u003C\u002Fdiv\u003E\n )\n}\n```\n\n**子应用必须导出生命周期钩子函数**\n\n`bootstrap、mount、unmount`\n\n```typescript\nexport async function bootstrap() {\n  console.log('react bootstrap')\n}\n\nexport async function mount() {\n  console.log('react mount')\n  ReactDOM.render(\u003CApp \u002F\u003E, document.getElementById('app-react'))\n}\n\nexport async function unmount() {\n  console.log('react unmout')\n  let root = document.getElementById('sub-react');\n  root.innerHTML = ''\n}\n\n```\n\n**全局状态通信\u002F存储**\n\n应用之间通信的场景是有，但绝大多数情况下数据量少，频度低，所以全局Store设计的也很简单。\n\n在主应用中：\n\n- initCosmosStore:初始化store\n\n- subscribeStore:监听store变化\n\n- changeStore：给store派发新值\n\n- getStore：获取store当前快照\n\n\n\n```typescript\nlet store = initCosmosStore({ name: 'chuifengji' })\n\nstore.subscribeStore((newValue, oldValue) =\u003E {\n\n  console.log(newValue, oldValue);\n\n})\n\nstore.changeStore({ name: 'wzx' })\n\nstore.getStore();\n\n```\n\n\n\n在子应用中：\n\n```typescript\nexport async function mount(rootStore) {\n\n  rootStore.subscribeStore((newValue, oldValue) =\u003E {\n    console.log(newValue, oldValue);\n  }\n  \n  rootStore.changeStore({ name: 'xjp' }).then(res =\u003E console.log(res))\n  \n  rootStore.getStore();\n  \n  instance = new Vue({\n    router,\n    store,\n    render: h =\u003E h(App)\n  }).$mount('#app-vue')\n}\n\n```\n\n\n\n### html-loader\n\nhtml-loader是通过获取页面的html,来获取app的信息，相对的一种方法是JS-loader,Js-loader和子应用的耦合性要高一点，子应用得和主应用约定好承载容器不是。\n\n那html-loader是如何工作的呢？其实很简单，就是通过应用的入口地址，如：http:\u002F\u002Flocalhost:3001, 再调用fetch函数。获取到html的text格式信息后，我们需要从中取出我们需要的部分挂载到子应用承载点上。下面这张图是上面那个微前端demo的element结构。你可以看到子应用被挂在**id为sub-react**的标签下。\n\n![](\u002F\u002Fp3-juejin.byteimg.com\u002Ftos-cn-i-k3u1fbpfcp\u002F7fd7c97419024d39b1a0c5c0546c419d~tplv-k3u1fbpfcp-zoom-1.image)\n\n如何来做呢？\n\n我想你的第一反应可能是正则，我一开始也是用正则来处理的，但是我后来发现，正则太难完备了（原谅我这个正则盲）我总能写出示例让我自己的正则导出错误的结果。并且用正则来写，代码看着确实挺乱的，后期维护也不太方便。既然是html字符串，为什么我们不用dom api来处理呢?第一反应又是iframe,直接新建一个iframe，利用src属性加载iframe。问题来了，我怎么知道iframe什么时候加载好了？onload吗，显然不行，我们只是为了取出数据而已。**DOMContentLoaded**？像下面这样，写一个ready函数，还是不行，**DOMContentLoaded**会等待js执行完才回调。对SPA来说，这时间可能有点长了。\n\n\n\n```js\nfunction iframeReady(iframe: HTMLIFrameElement, iframeName: string): Promise\u003CDocument\u003E {\n    return new Promise(function (resolve, reject) {\n        window.frames[iframeName].addEventListener('DOMContentLoaded', () =\u003E {\n            let html = iframe.contentDocument || (iframe.contentWindow as Window).document;\n            resolve(html);\n        });\n    });\n}\n```\n\n没办法，只好想别的办法，写定时函数来判断dom中是否存在body节点，通过适当调整定时函数的执行周期，好像可以，但我们无法知道子应用的结构，依赖于body还是不行的，太不可靠了。\n\n```typescript\nfunction iframeReady(iframe: HTMLIFrameElement): Promise\u003CDocument\u003E {\n    return new Promise(function (resolve, reject) {\n        (function isiframeReady() {\n            if (iframe.contentDocument.body || (iframe.contentWindow as Window).document.body) {\n                resolve(iframe.contentDocument || (iframe.contentWindow as Window).document)\n            } else {\n                setInterval(isiframeReady, 10)\n            }\n        })()\n    })\n}\n```\n\n而且要获取到iframe的`contentWindow`的话你需要将iframe挂在到dom上，确实，可以设置为`display:none`，但太不优雅了。怎么看怎么不舒服。\n\n`srcdoc`?是个不错的选择，可惜IE不支持这个新属性。\n\n那就将正则和DOM API结合吧。我们通过正则获取head和body节点下的内容，这两个正则还是挺容易完备的，再将它们`innerHtml`到`createElement`出的一个div节点中，通过DOM API来遍历。DOM的结构是稳定的，我们可以轻松可靠的获取我们想要的内容，即html结构信息和js。\n\n### js隔离\n\n**微前端沙箱没有完美实践？**\n\n微前端中既然存在多个独立开发的应用，自然需要隔离js，采取的方式是构建沙箱。在浏览器当中，沙箱隔离了操作系统和浏览器渲染引擎，限制进程对操作系统资源的访问和修改。实际上，如果我们需要的app需要执行一些信任度不高的外部js的时候你也是需要沙箱的。一般情况下，我们说的沙箱强调的是两层，隔离和安全。js沙箱本身是个蛮大的坑，好在大部分情况下代码安全都不是微前端要考虑的问题，主应用对接入的子应用不能信任这样的情况还是比较少。微前端中的沙箱要考虑的是第一层，完全的隔离反而会带来问题。\n\n如果不考虑全局对象，不考虑DOM和BOM，我们要做的事情其实非常简单。使用new Function,这样子应用之间的变量都运行在函数作用域中，自然不会冲突了，但是我们还是得考虑全局变量，考虑DOM和BOM。特别是那些个框架大多都改了原生对象。那我们如何实现window的隔离呢？\n\n主要的思路有三种：\n\n**快照沙箱：**\n\n快照沙箱实际上就是在应用mount时激活生成快照，在unmount时失活恢复原有环境。比如app A挂载时修改了一个全局变量`window.appName = 'vue'`,那我就可以记录下当前的快照（修改前的属性值）。当app A卸载时，我就可以把当前的快照和当前环境进行比对，获知原有环境从而恢复运行环境。\n\n```typescript\nclass SnapshotSandbox {\n    constructor() {\n        this.proxy = window; \n        this.modifyPropsMap = {}; \u002F\u002F 修改了哪些属性\n        this.active();\n    }\n    active() {\n        this.windowSnapshot = {}; \u002F\u002F window对象的快照\n        for (const prop in window) {\n            if (window.hasOwnProperty(prop)) {\n                \u002F\u002F 将window上的属性进行拍照\n                this.windowSnapshot[prop] = window[prop];\n            }\n        }\n        Object.keys(this.modifyPropsMap).forEach(p =\u003E {\n            window[p] = this.modifyPropsMap[p];\n        });\n    }\n    inactive() {\n        for (const prop in window) { \u002F\u002F diff 差异\n            if (window.hasOwnProperty(prop)) {\n                \u002F\u002F 将上次拍照的结果和本次window属性做对比\n                if (window[prop] !== this.windowSnapshot[prop]) {\n                    \u002F\u002F 保存修改后的结果\n                    this.modifyPropsMap[prop] = window[prop]; \n                    \u002F\u002F 还原window\n                    window[prop] = this.windowSnapshot[prop]; \n                }\n            }\n        }\n    }\n}\n\nlet sandbox = new SnapshotSandbox();\n((window) =\u003E {\n    window.a = 1;\n    window.b = 2;\n    window.c = 3\n    console.log(a,b,c)\n    sandbox.inactive();\n    console.log(a,b,c)\n})(sandbox.proxy);\n```\n\n快照沙箱的思路很简单，也很容易做到子应用的状态保持，但是显然快照沙箱只能支持单实例的场景，对于多实例共存的场景，它就无能为力了。\n\n**借用iframe:**\n\n啊这个，也太没逼格了。开玩笑，其实iframe也不好做，虽然我们通过它可以拿到完全隔离的 `window`、`document` 等上下文。但还是不能直接加以使用的，你得通过`postMessage`,建立iframe和主应用之间的通信。不然路由啥的还玩个锤子。\n\n**proxy代理:**\n\n```typescript\nclass ProxySandbox {\n    constructor() {\n        const rawWindow = window;\n        const fakeWindow = {}\n        const proxy = new Proxy(fakeWindow, {\n            set(target, p, value) {\n                target[p] = value;\n                return true\n            },\n            get(target, p) {\n                return target[p] || rawWindow[p];\n            }\n        });\n        this.proxy = proxy\n    }\n}\nlet sandbox1 = new ProxySandbox();\nlet sandbox2 = new ProxySandbox();\nwindow.a = 1;\n((window) =\u003E {\n    window.a = {a:'ldl'};\n    console.log(window.a)\n})(sandbox1.proxy);a:'ldl'\n((window) =\u003E {\n    window.a = 'world';\n    console.log(window.a)\n})(sandbox2.proxy);\n```\n\n上面这个proxy是很简单了，读时优先获取\"拷贝值\"，没有就代理到原值，写时代理到“拷贝值”。但它存在着诸多问题，且不说各种恶意代码，如果全局对象使用self、this、globalThis，代理就无效了，只代理get和set也是不够的。最重要的，只是在一定程度上隔离了全局变量而已，window的原生对象和方法，全部失效。\n\n```typescript\nfunction getOwnPropertyDescriptors(target: any) {\n    const res: any = {}\n    Reflect.ownKeys(target).forEach(key =\u003E {\n        res[key] = Object.getOwnPropertyDescriptor(target, key)\n    })\n    return res\n}\n\n\nexport function copyProp(target: any, source: any) {\n    if (Array.isArray(target)) {\n        for (let i = 0; i \u003C source.length; i++) {\n            if (!(i in target)) {\n                target[i] = source[i];\n            }\n        }\n    }\n    else {\n        const descriptors = getOwnPropertyDescriptors(source)\n        \u002F\u002Fdelete descriptors[DRAFT_STATE as any]\n        let keys = Reflect.ownKeys(descriptors)\n        for (let i = 0; i \u003C keys.length; i++) {\n            const key: any = keys[i]\n            const desc = descriptors[key]\n            if (desc.writable === false) {\n                desc.writable = true\n                desc.configurable = true\n            }\n            if (desc.get || desc.set)\n                descriptors[key] = {\n                    configurable: true,\n                    writable: true, \n                    enumerable: desc.enumerable,\n                    value: source[key]\n                }\n        }\n        target = Object.create(Object.getPrototypeOf(source), descriptors)\n        console.log(target)\n    }\n}\n\nexport function copyOnWrite(draftState: {\n    originalValue: {\n        [key: string]: any;\n    };\n    draftValue: any;\n    onWrite: any;\n    mutated: boolean;\n}) {\n    const { originalValue, draftValue, mutated, onWrite } = draftState;\n    if (!mutated) {\n        draftState.mutated = true;\n        if (onWrite) {\n            onWrite(draftValue);\n        }\n        copyProp(draftValue, originalValue);\n    }\n}\n\n```\n\n沙箱难做的原因是，是因为有矛盾点，那就是我们既希望能做到尽可能的隔离，但你又不应当做到完全的隔离。在这个界限之间，就会有冲突。\n\nmicrocosmos的沙箱就是用proxy实现的，目前的做法是通过copy-on-write实现部分window部分下对象的拷贝，window下的方法还是bind到原方法上的，这个确实没什么好办法。如果怕造成冲突，可以通过添加黑白名单的方式，限制子应用对某些方法的访问，或者自己模拟实现一些方法，再进行通信。不管哪种方案，都不够优雅。\n\n我对这个部分的实现很不满意， 代码参考自`immer`，这个库实在有太多可以借鉴的东西。\n\n感兴趣的可以自己研究下：[immer](https:\u002F\u002Fgithub.com\u002Fimmerjs\u002Fimmer)\n\n### css隔离\n\n**我们需要在微前端容器设计中考虑隔离CSS吗？**\n\n其实我个人觉得这不是微前端容器要考虑的内容，因为这个问题和微前端无关，几乎是在有css起，我们就在遭遇这样的问题，SPA时代更是已经成了必须要考虑的问题。所以在microcosmos中我没有去解决css隔离的问题。你依然要像开发SPA一样，采取 BEM(Block Element Modifier)  约定项目前缀,css module,css-in-js等方案。\n\n而像qiankun所说的 **Dynamic Stylesheet**其实蛮无聊的（我自己也加了hh），子应用的装卸自然包含着css的装卸，但是这不能保证子应用与主应用之间没有冲突，更不用说还可能存在多个子应用并行的情况。(当然了，他们现在也提出了其他方案，值得期待！）\n\n那你可能会说，Why not shadow dom?\n\nshadow dom确实天生隔离样式，我们很多的开源组件库都使用了shadow dom。但是要把整个应用挂在shadow dom风险还是太大了。会出现各种各样的问题。\n\n比如React17之前，为了减少 DOM 上的事件对象来节省内存，优化页面性能，同时也为了实现事件调度机制，所有的事件都代理到document元素上。 而`shadow dom` 里触发的事件，在外层拿到 `event.target `的时候，只会拿到 host(宿主元素)，所以导致了 react 的事件调度出现问题。\n\n![](\u002F\u002Fp3-juejin.byteimg.com\u002Ftos-cn-i-k3u1fbpfcp\u002Fbd7b397a2b924f5aa3fa3525cd9879df~tplv-k3u1fbpfcp-zoom-1.image)\n\n如果你不了解react，我解释一下。\n\n在React 的「合成事件机制」中「事件」并不会直接绑定到具体的 DOM 元素上，而是通过在 document 上绑定的 `ReactEventListener `来管理， 当时元素被单击或触发其他事件时，事件被 dispatch 到 document 时将由 React 进行处理并触发相应合成事件的执行。\n\n对于shadow dom，因为主文档内部的脚本并不了解 shadow dom 内部，尤其是当组件来自于第三方库，所以，为了保持细节简单，浏览器会**重新定位**（retarget）事件。**当事件在组件外部捕获时，shadow DOM 中发生的事件将会以 host 元素作为目标**。\n\n这将让 React 在处理合成事件时，不认为 ShadowDOM 中元素基于 JSX 语法绑定的事件被触发了。\n\n当然了，更大的问题是shadow dom只是隔离了内部与外部，内部还是会有冲突的可能呀。\n\n### life-cycle\n\n**生命周期循环是个大遍历。**\n\n每次路由发生有效改变的时候我们需要触发`lifeCycle`，对已经注册的app进行遍历，该卸载的卸载，该注入的注入。\n\nlifeCycle会遍历子应用列表，依次执行它们的生命周期函数，这里有个小问题，子应用的生命周期函数是如何被主应用获取到的，如果你和我一样不熟悉webpack，或许会陷入这样的困惑，事实上，webpack以`umd`格式进行打包的话，require函数会将export出的函数合成一个model挂到window上。这样我们就可以获取啦。\n\n本身倒没有什么问题，只是我写的lifeCycle，对于应用状态依赖有点弱。。比如说，第一次进入某个子应用需要fetch，后面就不应需要了。我的做法是通过函数缓存来实现，但是整个生命周期的执行没有丝毫变化，这样似乎不太好，不够优雅。\n\n这里倒是有个要补充的点，我们希望用户的点击触发`window.history.pushState`事件，以此来显式的改变地址栏url，但是我们还需要对pushSate进行监听来触发函数切换应用。pushState又是没法被直接监听的，我们需要对window.history.pushState事件进行包装，通过监听自定义事件来监听history变化，下面是实现函数。\n\n```typescript\nexport function patchEventListener(event: any, ListerName: string) {\n    return function (this: any) {\n        const e = new Event(ListerName);\n        event.apply(this, arguments)\n        window.dispatchEvent(e);\n    };\n}\nwindow.history.pushState = patchEventListener(window.history.pushState, \"cosmos_pushState\");\nwindow.addEventListener(\"cosmos_pushState\", routerChange);\n```\n\n\n\n### 应用通信\n\n**需求决定实现。**\n\n理想的微前端可能都不需要这个设计，因为我们说了，子应用是不知道自己是作为子应用在运行的，但是毕竟只是理想。我们还是会有一些父子通信的需求。一般情况下，在微前端中，父子应用之间，子应用之间的通信频度较低，数据量较小。\n\n所以在**microcosmos** 里我只是运用了简单的发布订阅来实现。靠，你这也太简单了吧。（别骂了别骂了，能用就行\n\n```typescript\nexport function initCosmosStore(initData) {\n    return window.MICROCOSMOS_ROOT_STORE = (function () {\n        let store = initData;\n        let observers: Array\u003CFunction\u003E = [];\n        function getStore() {\n            return store;\n        }\n        function changeStore(newValue) {\n            return new Promise((resolve, reject) =\u003E {\n                if (newValue !== store) {\n                    let oldValue = store;\n                    store = newValue;\n                    resolve(store);\n                    observers.forEach(fn =\u003E fn(newValue, oldValue));\n                }\n            })\n        }\n        function subscribeStore(fn) {\n            observers.push(fn);\n        }\n        return { getStore, changeStore, subscribeStore }\n    })()\n}\n```\n\n### 预加载\n\n预加载是为了降低白屏时间，获取更流畅的应用切换效果，对于一些通过微前端实现的工作台，主应用上可能注册了十几个甚至更多的子应用，我们往往不会在短时间内都执行它们，那通过预加载，就能够提前抓取子应用的数据信息，让微前端的优势发挥到极致。\n\n要注意的是浏览器同域名下的并发请求数量是有限制的，不同浏览器可能都不太一样，比如在chrome上可能是6，所以我们需要对子应用列表进行切片，再通过promise 链式调用。\t\n\n至此，microcosmos的技术实现就讲完啦，当然还是有些小细节，没法全部来讲。\n\n## 总结\n\n\n\n微前端的架构虽然看起来简单，但如果真的要做一个高可用的版本，还有很多的路要走，相信未来我们会有更完善的一整套微前端工程化方案，而不是局限于容器。\n\n![](\u002F\u002Fp3-juejin.byteimg.com\u002Ftos-cn-i-k3u1fbpfcp\u002F6e641fb4db124b008907f6e69cd5afc1~tplv-k3u1fbpfcp-zoom-1.image)\n\nPS:即将发布的webpack5的特性之一[module federation](https:\u002F\u002Frichlab.design\u002Ftranslations\u002F2020\u002F03\u002F27\u002Fwebpack-5-module-federation)使得JavaScript 应用得以从另一个 JavaScript 应用中动态地加载代码 —— 同时共享依赖。如果某应用所消费的 federated module 没有 federated code 中所需的依赖，Webpack 将会从 federated 构建源中下载缺少的依赖项， webpack能够更好更方便地支持不同工程之间构建产物的互相加载，让我们一起看看这最终会给微前端带来什么。\n\n## 引用\n\n- [微服务概念]()\n\n- [Micro Frontends](https:\u002F\u002Fmartinfowler.com\u002Farticles\u002Fmicro-frontends.html)\n\n- [new 一个 immer by ayqy](http:\u002F\u002Fwww.ayqy.net\u002Fblog\u002Fnew一个immer\u002F)\n\n- [Module Federation](https:\u002F\u002Frichlab.design\u002Ftranslations\u002F2020\u002F03\u002F27\u002Fwebpack-5-module-federation)\n\n  \n\n"},author_user_info:{user_id:"1688448856764088",user_name:"Ethanlv_吹风机",company:e,job_title:"不会编程的大三🐕",avatar_large:"https:\u002F\u002Fsf1-ttcdn-tos.pstatp.com\u002Fimg\u002Fuser-avatar\u002F22c47e28b80d07d43845d5cba74aa9ff~120x256.image",level:h,description:"好奇之心，改变之力~",followee_count:7,follower_count:11,post_article_count:d,digg_article_count:5,got_digg_count:47,got_view_count:4336,post_shortmsg_count:d,digg_shortmsg_count:d,isfollowed:a,favorable_author:d,power:83},category:{category_id:"6809637767543259144",category_name:"前端",category_url:"frontend",rank:2,ctime:1457483942,mtime:1432503190,show_type:3,id:"6809637767543259144",name:"前端",title:"前端",alias:"frontend"},tags:[{entriesCount:void 0,subscribed:a,id:"6809640402103042061",tag_id:"6809640402103042061",tag_name:"前端框架",color:"#F2AB5B",icon:"https:\u002F\u002Flc-gold-cdn.xitu.io\u002Ff7a198f1e1aeb6d79878.png",back_ground:e,show_navi:d,tag_alias:e,post_article_count:3116,concern_user_count:224298,title:"前端框架",tagId:"6809640402103042061",articleCount:3116,subscribersCount:224298,createdAt:b,updatedAt:b}],user_interact:{id:6864381092061774000,omitempty:2,user_id:d,is_digg:a,is_follow:a,is_collect:a},title:" 微前端“容器”——microcosmos实现",user:{id:"1688448856764088",self_description:void 0,followed:a,viewerIsFollowing:void 0,community:void 0,subscribedTagCount:d,wroteBookCount:d,boughtBookCount:d,isBindedPhone:a,level:h,user_id:"1688448856764088",user_name:"Ethanlv_吹风机",company:e,job_title:"不会编程的大三🐕",avatar_large:"https:\u002F\u002Fsf1-ttcdn-tos.pstatp.com\u002Fimg\u002Fuser-avatar\u002F22c47e28b80d07d43845d5cba74aa9ff~120x256.image",description:"好奇之心，改变之力~",followee_count:7,follower_count:11,post_article_count:d,digg_article_count:5,got_digg_count:47,got_view_count:4336,post_shortmsg_count:d,digg_shortmsg_count:d,isfollowed:a,favorable_author:d,power:83,juejinPower:83,jobTitle:"不会编程的大三🐕",roles:{isBookAuthor:a,isFavorableAuthor:a,isCobuilder:a,isAdmin:a},username:"Ethanlv_吹风机",blogAddress:void 0,selfDescription:"好奇之心，改变之力~",beLikedCount:47,beReadCount:4336,followerCount:11,followingCount:7,collectionCount:d,createdCollectionCount:d,followingCollectionCount:d,postedPostsCount:d,pinCount:d,likedArticleCount:5,likedPinCount:d,avatar:"https:\u002F\u002Fsf1-ttcdn-tos.pstatp.com\u002Fimg\u002Fuser-avatar\u002F22c47e28b80d07d43845d5cba74aa9ff~120x256.image",latestLoginedInAt:b,createdAt:b,updatedAt:b,phoneNumber:e,titleDescription:e,followeesCount:7},viewCount:void 0,commentsCount:6,isEvent:void 0,abstract:"​ 我第一次听说微前端这个概念是在一年前左右偶然看到了美团的一篇技术博客：用微前端的方式搭建单页应用。然而那时候我连单页面应用是什么都还不知道，自然是看的一头雾水了。目前大家普遍认为微前端的概念由ThoughtWorks在2016年提出。四年的时间，飞速发展，目前我们已经能看到…",latestCommentAt:b,createdAt:new Date(1598238302000),updatedAt:b,isTopicEvent:a,likedCount:42,likeCount:42,content:e,originalUrl:e,type:"post",collected:a,viewsCount:4115,username:"Ethanlv_吹风机",viewerHasLiked:a,draftId:"6864379334061195278",collectionCount:d},entryView:{},author:{id:"1688448856764088",self_description:void 0,followed:a,viewerIsFollowing:void 0,community:void 0,subscribedTagCount:d,wroteBookCount:d,boughtBookCount:d,isBindedPhone:a,level:h,user_id:"1688448856764088",user_name:"Ethanlv_吹风机",company:e,job_title:"不会编程的大三🐕",avatar_large:"https:\u002F\u002Fsf1-ttcdn-tos.pstatp.com\u002Fimg\u002Fuser-avatar\u002F22c47e28b80d07d43845d5cba74aa9ff~120x256.image",description:"好奇之心，改变之力~",followee_count:7,follower_count:11,post_article_count:d,digg_article_count:5,got_digg_count:47,got_view_count:4336,post_shortmsg_count:d,digg_shortmsg_count:d,isfollowed:a,favorable_author:d,power:83,juejinPower:83,jobTitle:"不会编程的大三🐕",roles:{isBookAuthor:a,isFavorableAuthor:a,isCobuilder:a,isAdmin:a},username:"Ethanlv_吹风机",blogAddress:void 0,selfDescription:"好奇之心，改变之力~",beLikedCount:47,beReadCount:4336,followerCount:11,followingCount:7,collectionCount:d,createdCollectionCount:d,followingCollectionCount:d,postedPostsCount:d,pinCount:d,likedArticleCount:5,likedPinCount:d,avatar:"https:\u002F\u002Fsf1-ttcdn-tos.pstatp.com\u002Fimg\u002Fuser-avatar\u002F22c47e28b80d07d43845d5cba74aa9ff~120x256.image",latestLoginedInAt:b,createdAt:b,updatedAt:b,phoneNumber:e,titleDescription:e,followeesCount:7},adEntryList:[],relatedEntryList:[],actionType:{FETCH:"view\u002Fcolumn\u002FFETCH",FETCH_ADDITIONAL:"view\u002Fcolumn\u002FFETCH_ADDITIONAL",FETCH_SIDEBAR_ADENTRY:"view\u002Fcolumn\u002FFETCH_SIDEBAR_ADENTRY",RESET:"view\u002Fcolumn\u002FRESET"},recommendedArticleList:{list:[],tagIds:[],cursor:f,loading:a,skeleton:a,hasMore:a,articleId:e,actionType:{UPDATE_STATE:"view\u002Fcolumn\u002Frecommend-List\u002FUPDATE_STATE",FETCH_MORE:"view\u002Fcolumn\u002Frecommend-List\u002FFETCH_MORE",FETCH:"view\u002Fcolumn\u002Frecommend-List\u002FFETCH",RESET:"view\u002Fcolumn\u002Frecommend-List\u002FRESET"}}},collection:{collection:{author:{}},actionType:{FETCH:"@\u002Fview\u002Fcollection\u002FFETCH",REFRESH:"@\u002Fview\u002Fcollection\u002FREFRESH",RESET:"@\u002Fview\u002Fcollection\u002FRESET"},list:{pageSize:g,page:h,total:d,pointer:b,lastPointer:b,list:[],loading:a,error:b,canPrev:c,canNext:c,linkList:[],lastFetchOnServer:a,actionType:{UPDATE:"@\u002Fview\u002Fcollection\u002Flist\u002FUPDATE",FETCH:"@\u002Fview\u002Fcollection\u002Flist\u002FFETCH",FORCE_FETCH:"@\u002Fview\u002Fcollection\u002Flist\u002FFORCE_FETCH",FETCH_MORE:"@\u002Fview\u002Fcollection\u002Flist\u002FFETCH_MORE",RESET:"@\u002Fview\u002Fcollection\u002Flist\u002FRESET"},id:e,sort:o}},gettingStarted:{category:{},actionType:{UPDATE_STATE:"@\u002Fview\u002FgettingStarted\u002FUPDATE_STATE",FOLLOW:"@\u002Fview\u002FgettingStarted\u002FFOLLOW",RESET:"@\u002Fview\u002FgettingStarted\u002FRESET",UPDATE_CATEGORY:"@\u002Fview\u002FgettingStarted\u002FUPDATE_CATEGORY"}},pin:{pin:{user:{},imageUrlList:[]},pinList:[],actionType:{FETCH:"@\u002Fview\u002Fpin\u002FFETCH",RESET:"@\u002Fview\u002Fpin\u002FRESET"},sidebar:{list:[],after:e,loading:a,isRecommend:a,hasNextPage:c,actionType:{UPDATE_STATE:"@\u002Fview\u002Fpin\u002Fsidebar\u002FUPDATE_STATE",FETCH_MORE:"@\u002Fview\u002Fpin\u002Fsidebar\u002FFETCH_MORE",FETCH:"@\u002Fview\u002Fpin\u002Fsidebar\u002FFETCH",RESET:"@\u002Fview\u002Fpin\u002Fsidebar\u002FRESET"}},commentList:{pageSize:g,page:h,total:d,pointer:b,lastPointer:b,list:[],loading:a,error:b,canPrev:c,canNext:c,linkList:[],lastFetchOnServer:a,actionType:{UPDATE:"@\u002Fview\u002Fpin\u002FcommentList\u002FUPDATE",FETCH:"@\u002Fview\u002Fpin\u002FcommentList\u002FFETCH",FORCE_FETCH:"@\u002Fview\u002Fpin\u002FcommentList\u002FFORCE_FETCH",FETCH_MORE:"@\u002Fview\u002Fpin\u002FcommentList\u002FFETCH_MORE",RESET:"@\u002Fview\u002Fpin\u002FcommentList\u002FRESET"},pinId:b},subCommentList:{pageSize:g,page:h,total:d,pointer:b,lastPointer:b,list:[],loading:a,error:b,canPrev:c,canNext:c,linkList:[],lastFetchOnServer:a,actionType:{UPDATE:"@\u002Fview\u002Fpin\u002FsubCommentList\u002FUPDATE",FETCH:"@\u002Fview\u002Fpin\u002FsubCommentList\u002FFETCH",FORCE_FETCH:"@\u002Fview\u002Fpin\u002FsubCommentList\u002FFORCE_FETCH",FETCH_MORE:"@\u002Fview\u002Fpin\u002FsubCommentList\u002FFETCH_MORE",RESET:"@\u002Fview\u002Fpin\u002FsubCommentList\u002FRESET"},commentId:b}},topic:{topic:e,followedTopicList:[],actionType:{FETCH:"@\u002Fview\u002Ftopic\u002FFETCH",UPDATE_STATE:"@\u002Fview\u002Ftopic\u002FUPDATE_STATE",RESET:"@\u002Fview\u002Ftopic\u002FRESET"},allTopicList:{pageSize:r,page:d,total:d,pointer:b,lastPointer:b,list:[],loading:a,error:b,canPrev:c,canNext:c,linkList:[],lastFetchOnServer:a,actionType:{UPDATE:"@\u002Fview\u002Ftopic\u002FallTopicList\u002FUPDATE",FETCH:"@\u002Fview\u002Ftopic\u002FallTopicList\u002FFETCH",FORCE_FETCH:"@\u002Fview\u002Ftopic\u002FallTopicList\u002FFORCE_FETCH",FETCH_MORE:"@\u002Fview\u002Ftopic\u002FallTopicList\u002FFETCH_MORE",RESET:"@\u002Fview\u002Ftopic\u002FallTopicList\u002FRESET"},sortType:k},pinlist:{pageSize:g,page:h,total:d,pointer:b,lastPointer:b,list:[],loading:a,error:b,canPrev:c,canNext:c,linkList:[],lastFetchOnServer:a,actionType:{UPDATE:"@\u002Fview\u002Ftopic\u002FpinList\u002FUPDATE",FETCH:"@\u002Fview\u002Ftopic\u002FpinList\u002FFETCH",FORCE_FETCH:"@\u002Fview\u002Ftopic\u002FpinList\u002FFORCE_FETCH",FETCH_MORE:"@\u002Fview\u002Ftopic\u002FpinList\u002FFETCH_MORE",RESET:"@\u002Fview\u002Ftopic\u002FpinList\u002FRESET"},sortType:m},sidebar:{actionType:{RESET:"@\u002Fview\u002Ftopic\u002Fsidebar\u002FRESET",UPDATE_STATE:"@\u002Fview\u002Ftopic\u002Fsidebar\u002FUPDATE_STATE"},attender:{pageSize:g,page:h,total:d,pointer:b,lastPointer:b,list:[],loading:a,error:b,canPrev:c,canNext:c,linkList:[],lastFetchOnServer:a,actionType:{UPDATE:"@\u002Fview\u002Ftopic\u002Fsidebar\u002Fattender\u002FUPDATE",FETCH:"@\u002Fview\u002Ftopic\u002Fsidebar\u002Fattender\u002FFETCH",FORCE_FETCH:"@\u002Fview\u002Ftopic\u002Fsidebar\u002Fattender\u002FFORCE_FETCH",FETCH_MORE:"@\u002Fview\u002Ftopic\u002Fsidebar\u002Fattender\u002FFETCH_MORE",RESET:"@\u002Fview\u002Ftopic\u002Fsidebar\u002Fattender\u002FRESET"},topicId:b}},followedList:{pageSize:r,page:d,total:d,pointer:b,lastPointer:b,list:[],loading:a,error:b,canPrev:c,canNext:c,linkList:[],lastFetchOnServer:a,actionType:{UPDATE:"@\u002Fview\u002Ftopic\u002FfollowedList\u002FUPDATE",FETCH:"@\u002Fview\u002Ftopic\u002FfollowedList\u002FFETCH",FORCE_FETCH:"@\u002Fview\u002Ftopic\u002FfollowedList\u002FFORCE_FETCH",FETCH_MORE:"@\u002Fview\u002Ftopic\u002FfollowedList\u002FFETCH_MORE",RESET:"@\u002Fview\u002Ftopic\u002FfollowedList\u002FRESET"},after:d}},recommendationIndex:{actionType:{FETCH_USER:"@\u002Fview\u002Frecommendation\u002FFETCH_USER",FETCH_MORE:"@\u002Fview\u002Frecommendation\u002FFETCH_MORE",RESET:"@\u002Fview\u002Frecommendation\u002FRESET",FETCH:"@\u002Fview\u002Frecommendation\u002FFETCH"},cursor:e,hasMore:e,userList:[],loading:a,skeleton:c,category:j,categoryNavList:[]}},component:{indexAside:{bannerList:[],userList:[],actionType:{FETCH_BANNER:"@\u002Fcomponent\u002Faside\u002FFETCH_BANNER",FETCH_USER:"@\u002Fcomponent\u002Faside\u002FFETCH_USER",CLOSE_BANNER:"@\u002Fcomponent\u002Faside\u002FCLOSE_BANNER"}}},auth:{user:b,clientId:e,token:e},tag:{subscribedTagList:[]},entry:{isLikeLoading:a},collection:{},comment:{},bookComment:{},repoComment:{},category:{list:[]},user:{subscribedTagList:[]},notification:{unreadCount:{user:d,system:d,total:d}},follow:{subscribedTagList:[]},error:{location:b,errorView:b,statusCode:200},abTest:{info:{}},suspensionPanel:{needSuspension:c},pinComment:{},pin:{deleteDialogVisible:a,reportDialogVisible:a,targetPin:b,isOnFocus:a},topic:{visible:a},route:{name:"column",path:p,hash:e,query:{},params:{id:q},fullPath:p,meta:{},from:{name:b,path:s,hash:e,query:{},params:{},fullPath:s,meta:{}}}},serverRendered:c,routePath:p,config:{API_HOST:"apinew.juejin.im",CAPTCHA_HOST:"verify.snssdk.com",PLATFORM_APPID:{wechat:833,weibo:845,github:1032,wechatApp:1070}}}}(false,null,true,0,"","0",20,1,"topic","recommended","hot","following","popular","all","newest","\u002Fpost\u002F6864381092061773831","6864381092061773831",100,"\u002F"));</script><script src="//s3.pstatp.com/toutiao/xitu_juejin_web/runtime.114be94.js" defer></script><script src="//s3.pstatp.com/toutiao/xitu_juejin_web/layouts/default.30f8654.js" defer></script><script src="//s3.pstatp.com/toutiao/xitu_juejin_web/commons/layouts.default.e3ae69c.js" defer></script><script src="//s3.pstatp.com/toutiao/xitu_juejin_web/16.042eec3.js" defer></script><script src="//s3.pstatp.com/toutiao/xitu_juejin_web/commons/.c96a556.js" defer></script><script src="//s3.pstatp.com/toutiao/xitu_juejin_web/commons/app.f6a55cd.js" defer></script><script src="//s3.pstatp.com/toutiao/xitu_juejin_web/vendors~app.75ea36e.js" defer></script><script src="//s3.pstatp.com/toutiao/xitu_juejin_web/app.6946cbd.js" defer></script>
  </body>
</html>
